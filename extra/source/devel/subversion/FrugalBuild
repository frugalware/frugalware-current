# Last Modified: Mon, 26 Jun 2006 16:05:22 +0200
# Compiling Time: 3.50 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: VMiklos <vmiklos@frugalware.org>

pkgname=subversion
pkgver=1.3.2
pkgrel=2
pkgdesc="A version control system that is a compelling replacement for CVS."
url="http://subversion.tigris.org/"
depends=('postgresql' 'sqlite2' 'sqlite3' 'neon' 'apr-util')
backup=(etc/httpd/conf/modules.d/mod_dav_svn.conf)
makedepends=('apache' 'j2sdk' 'ruby>=1.8.4' 'swig=1.3.28')
groups=('devel-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump $url/project_packages.html|grep best|sed 's/.*]\(.*\)/\1/'"
source=(http://$pkgname.tigris.org/downloads/$pkgname-$pkgver.tar.bz2 rc.svnserve \
	mod_dav_svn.conf)
sha1sums=('688ab178db1f6acb2ad3bd99f030402621f837b6' \
          '97c1e3055ad1e25e96d21a38e9525ce2a8c45c10' \
          'b4012364a9fbd9e8c490a4819780c31c67940428')
build()
{
	## baa I should split this whole stuff :S
	Fconf --with-{apr-util=/usr,apr=/usr,berkeley-db,zlib,neon=/usr,swig} \
	      --disable-experimental-libtool
	     ### --disable-neon-version-check ## enable this only on problems with neon
	(make external-all && make LT_LDFLAGS="-L$Fdestdir/usr/lib" local-all)  || return 1
	unset MAKEFLAGS
	Fmakeinstall
	## python
	make swig-py || return 1
	## perl
	## bug 64634
	mkdir -p subversion/bindings/swig/perl/native/blib/arch/auto/SVN/{_Client,_Delta,_Fs,_Ra,_Repos,_Wc}
	make swig-pl || return 1
	## ruby
	make swig-rb || return 1
	## java
	mkdir -p subversion/bindings/java/javahl/classes
	make JAVACFLAGS="-source 1.3 -encoding iso8859-1" javahl || return 1
	## fix svn-config
	Fsed "@SVN_DB_[^@]*@" "" svn-config
	Fsed "SVN_SOURCE_DIR=.*" "" svn-config
	Fsed "SVN_BUILD_DIR=.*" "" svn-config
	## install python
	make install-swig-py DESTDIR=$Fdestdir  DISTUTIL_PARAM=--prefix=$Fdestdir  LD_LIBRARY_PATH="-L$Fdestdir/usr/lib" || return 1
	Fmkdir /usr/lib/python2.4/site-packages
	Fmv usr/lib/svn-python/libsvn usr/lib/python2.4/site-packages/
	Fmv usr/lib/svn-python/svn usr/lib/python2.4/site-packages/
	Frm usr/lib/svn-python
	## install perl
	make DESTDIR=$Fdestdir install-swig-pl || return 1
	Frm /usr/lib/perl5/`perl -e 'printf "%vd", $^V'`
	Fmv /usr/lib/perl5/site_perl/`perl -e 'printf "%vd", $^V'` /usr/lib/perl5/site_perl/current
	## install ruby
	make DESTDIR=$Fdestdir install-swig-rb || return 1
	## install java
	make DESTDIR=$Fdestdir install-javahl || return 1
	Fexerel /usr/bin/svn-config
	## done huch ? :) guess no :)
	# hook scripts
	Fmkdir /usr/share/subversion
	cp -r tools/hook-scripts $Fdestdir/usr/share/subversion
	Frm /usr/share/subversion/hook-scripts/*.in
	## well mabye someone want use it ? :)
	Ffilerel tools/client-side/bash_completion etc/bash_completion.d/subversion
	## some devel stuff
	cp -r tools/dev $Fdestdir/usr/share/subversion
	cp -r tools/backup/* $Fdestdir/usr/share/subversion/dev
	Fmkdir /usr/share/doc/$pkgname-$pkgver
	cp -r doc $Fdestdir/usr/share/doc/$pkgname-$pkgver
	Frcd svnserve
	Ffile /etc/httpd/conf/modules.d/mod_dav_svn.conf
}

# optimization OK
