# Last Modified: Sun, 05 Mar 2006 01:02:54 +0100
# Compiling Time: ~0.01 SBU
# Contributor: VMiklos <vmiklos@frugalware.org>
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=opera
pkgver=8.52
pkgextraver=-20060201.1-static-qt.i386-en
pkgrel=3
pkgdesc="Opera web browser."
url="http://www.opera.com/linux/"
depends=('qt' 'gcc-lib' 'lesstif')
groups=('xapps-extra')
archs=('i686')
up2date="lynx -dump ftp://ftp.opera.com/pub/opera/linux/ |grep -wo opera.*[0-9][0-9][0-9] |sort -r | sed -ne 's|.*x/\(.*\)|\1|;s/\([0-9]\)/\1./;1 p'"
source=(ftp://ftp.opera.com/pub/opera/linux/852/final/en/i386/static/opera-$pkgver$pkgextraver.tar.bz2 \
	install.sh.diff)
sha1sums=('547dd2019213f240f7dc9e2f757c059731a35c59' \
	'ea009fbfcf85876e2888021fccae5cd21322b15c')
options=('nobuild' 'nodocs')

build()
{
	Fpatchall
	Fsed 'config_dir="/etc"' "config_dir=\"$Fdestdir/etc/\"" install.sh
	Fsed '/usr/share/applnk' "$Fdestdir/usr/share/applnk" install.sh
	Fsed '/usr/share/pixmaps' "$Fdestdir/usr/share/pixmaps" install.sh
	Fsed '/usr/share/icons' "$Fdestdir/usr/share/icons" install.sh
	Fsed '/etc/X11' "$Fdestdir/etc/X11" install.sh
	Fsed '/usr/share/gnome' "$Fdestdir/usr/share/gnome" install.sh
	Fsed '#\(OPERA_FORCE_JAVA_ENABLED=\)' '\1' install.sh
	Fsed '#\(export LD_PRELOAD OPERA_FORCE_JAVA_ENABLED\)' '\1' install.sh
	Fsed 'read str_answer' 'return 0' install.sh
	Fsed '/opt/kde' "$Fdestdir/usr" install.sh
	Fsed '\(str_localdirplugin=\).*$' '\1/usr/lib/opera/lib/opera/plugins' install.sh

	Fmkdir /etc
	Fmkdir /usr/share/pixmaps
	Fmkdir /usr/lib/opera/share/applications
	./install.sh --prefix="$Fdestdir"/usr/lib/opera
	Fmv /usr/lib/opera/share/applications /usr/share/applications

	for i in 48 32 22 16; do
		Fmkdir /usr/share/icons/hicolor/${i}x${i}/apps/
		Fmv /usr/lib/opera/share/opera/images/opera_${i}x${i}.png /usr/share/icons/hicolor/${i}x${i}/apps/opera.png
	done

	Fsed 'LD_PRELOAD="${OPERA_JAVA_DIR}/libawt.so"' \
		'LD_PRELOAD="$LD_PRELOAD"\:"${OPERA_JAVA_DIR}/libawt.so"' \
		$Fdestdir/usr/lib/opera/bin/opera
	Fsed "$Fdestdir" "" $Fdestdir/usr/lib/opera/bin/opera
	Fsed "$Fdestdir" "" $Fdestdir/usr/lib/opera/share/opera/java/opera.policy
	Ffilerel images/opera.xpm /usr/share/pixmaps/
	Fln ../lib/opera/bin/opera /usr/bin/opera
	echo "Plugin Path=/usr/lib/opera/lib/opera/plugins" >> \
		$Fdestdir/etc/opera6rc
}
