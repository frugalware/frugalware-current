diff -Naur criu-3.17.1/criu/cgroup.c criu-3.17.1.new/criu/cgroup.c
--- criu-3.17.1/criu/cgroup.c	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/criu/cgroup.c	2022-11-04 12:28:49.472599462 +0100
@@ -27,6 +27,7 @@
 #include "images/cgroup.pb-c.h"
 #include "kerndat.h"
 #include "linux/mount.h"
+#include "syscall.h"
 
 /*
  * This structure describes set of controller groups
diff -Naur criu-3.17.1/criu/cr-check.c criu-3.17.1.new/criu/cr-check.c
--- criu-3.17.1/criu/cr-check.c	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/criu/cr-check.c	2022-11-04 12:28:49.473599407 +0100
@@ -21,7 +21,6 @@
 #include <sys/prctl.h>
 #include <sched.h>
 #include <sys/mount.h>
-#include <linux/aio_abi.h>
 
 #include "../soccr/soccr.h"
 
@@ -52,6 +51,7 @@
 #include "net.h"
 #include "restorer.h"
 #include "uffd.h"
+#include "linux/aio_abi.h"
 
 #include "images/inventory.pb-c.h"
 
diff -Naur criu-3.17.1/criu/cr-restore.c criu-3.17.1.new/criu/cr-restore.c
--- criu-3.17.1/criu/cr-restore.c	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/criu/cr-restore.c	2022-11-04 12:28:49.473599407 +0100
@@ -22,7 +22,6 @@
 #include <compel/ptrace.h>
 #include "common/compiler.h"
 
-#include "linux/mount.h"
 #include "linux/rseq.h"
 
 #include "clone-noasan.h"
@@ -86,6 +85,8 @@
 #include <compel/plugins/std/syscall-codes.h>
 #include "compel/include/asm/syscall.h"
 
+#include "linux/mount.h"
+
 #include "protobuf.h"
 #include "images/sa.pb-c.h"
 #include "images/timer.pb-c.h"
diff -Naur criu-3.17.1/criu/include/aio.h criu-3.17.1.new/criu/include/aio.h
--- criu-3.17.1/criu/include/aio.h	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/criu/include/aio.h	2022-11-04 12:28:49.473599407 +0100
@@ -1,7 +1,7 @@
 #ifndef __CR_AIO_H__
 #define __CR_AIO_H__
 
-#include <linux/aio_abi.h>
+#include "linux/aio_abi.h"
 #include "images/mm.pb-c.h"
 unsigned int aio_estimate_nr_reqs(unsigned int size);
 int dump_aio_ring(MmEntry *mme, struct vma_area *vma);
diff -Naur criu-3.17.1/criu/include/linux/aio_abi.h criu-3.17.1.new/criu/include/linux/aio_abi.h
--- criu-3.17.1/criu/include/linux/aio_abi.h	1970-01-01 01:00:00.000000000 +0100
+++ criu-3.17.1.new/criu/include/linux/aio_abi.h	2022-11-04 12:28:49.473599407 +0100
@@ -0,0 +1,14 @@
+#ifndef __LINUX__AIO_ABI_H
+#define __LINUX__AIO_ABI_H
+
+typedef __kernel_ulong_t aio_context_t;
+
+/* read() from /dev/aio returns these structures. */
+struct io_event {
+	__u64 data; /* the data field from the iocb */
+	__u64 obj;  /* what iocb this event came from */
+	__s64 res;  /* result code for this event */
+	__s64 res2; /* secondary result */
+};
+
+#endif /* __LINUX__AIO_ABI_H */
diff -Naur criu-3.17.1/criu/include/linux/mount.h criu-3.17.1.new/criu/include/linux/mount.h
--- criu-3.17.1/criu/include/linux/mount.h	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/criu/include/linux/mount.h	2022-11-04 12:28:49.474599351 +0100
@@ -4,32 +4,34 @@
 #include "common/config.h"
 #include "compel/plugins/std/syscall-codes.h"
 
-#ifdef CONFIG_HAS_FSCONFIG
-#include <linux/mount.h>
-#else
+/* Copied from /usr/include/sys/mount.h */
+
+#ifndef FSCONFIG_CMD_CREATE
+/* The type of fsconfig call made.   */
 enum fsconfig_command {
-	FSCONFIG_SET_FLAG = 0,	      /* Set parameter, supplying no value */
-	FSCONFIG_SET_STRING = 1,      /* Set parameter, supplying a string value */
-	FSCONFIG_SET_BINARY = 2,      /* Set parameter, supplying a binary blob value */
-	FSCONFIG_SET_PATH = 3,	      /* Set parameter, supplying an object by path */
-	FSCONFIG_SET_PATH_EMPTY = 4,  /* Set parameter, supplying an object by (empty) path */
-	FSCONFIG_SET_FD = 5,	      /* Set parameter, supplying an object by fd */
-	FSCONFIG_CMD_CREATE = 6,      /* Invoke superblock creation */
+	FSCONFIG_SET_FLAG = 0, /* Set parameter, supplying no value */
+#define FSCONFIG_SET_FLAG FSCONFIG_SET_FLAG
+	FSCONFIG_SET_STRING = 1, /* Set parameter, supplying a string value */
+#define FSCONFIG_SET_STRING FSCONFIG_SET_STRING
+	FSCONFIG_SET_BINARY = 2, /* Set parameter, supplying a binary blob value */
+#define FSCONFIG_SET_BINARY FSCONFIG_SET_BINARY
+	FSCONFIG_SET_PATH = 3, /* Set parameter, supplying an object by path */
+#define FSCONFIG_SET_PATH FSCONFIG_SET_PATH
+	FSCONFIG_SET_PATH_EMPTY = 4, /* Set parameter, supplying an object by (empty) path */
+#define FSCONFIG_SET_PATH_EMPTY FSCONFIG_SET_PATH_EMPTY
+	FSCONFIG_SET_FD = 5, /* Set parameter, supplying an object by fd */
+#define FSCONFIG_SET_FD FSCONFIG_SET_FD
+	FSCONFIG_CMD_CREATE = 6, /* Invoke superblock creation */
+#define FSCONFIG_CMD_CREATE FSCONFIG_CMD_CREATE
 	FSCONFIG_CMD_RECONFIGURE = 7, /* Invoke superblock reconfiguration */
+#define FSCONFIG_CMD_RECONFIGURE FSCONFIG_CMD_RECONFIGURE
 };
-#endif
+#endif // FSCONFIG_CMD_CREATE
 
-static inline int sys_fsopen(const char *fsname, unsigned int flags)
-{
-	return syscall(__NR_fsopen, fsname, flags);
-}
-static inline int sys_fsconfig(int fd, unsigned int cmd, const char *key, const char *value, int aux)
-{
-	return syscall(__NR_fsconfig, fd, cmd, key, value, aux);
-}
-static inline int sys_fsmount(int fd, unsigned int flags, unsigned int attr_flags)
-{
-	return syscall(__NR_fsmount, fd, flags, attr_flags);
-}
+#ifndef MS_MGC_VAL
+/* Magic mount flag number. Has to be or-ed to the flag values.  */
+#define MS_MGC_VAL 0xc0ed0000 /* Magic flag number to indicate "new" flags */
+#define MS_MGC_MSK 0xffff0000 /* Magic flag number mask */
+#endif
 
 #endif
diff -Naur criu-3.17.1/criu/include/syscall.h criu-3.17.1.new/criu/include/syscall.h
--- criu-3.17.1/criu/include/syscall.h	1970-01-01 01:00:00.000000000 +0100
+++ criu-3.17.1.new/criu/include/syscall.h	2022-11-04 12:28:49.474599351 +0100
@@ -0,0 +1,17 @@
+#ifndef __CR_SYSCALL_H__
+#define __CR_SYSCALL_H__
+
+static inline int sys_fsopen(const char *fsname, unsigned int flags)
+{
+	return syscall(__NR_fsopen, fsname, flags);
+}
+static inline int sys_fsconfig(int fd, unsigned int cmd, const char *key, const char *value, int aux)
+{
+	return syscall(__NR_fsconfig, fd, cmd, key, value, aux);
+}
+static inline int sys_fsmount(int fd, unsigned int flags, unsigned int attr_flags)
+{
+	return syscall(__NR_fsmount, fd, flags, attr_flags);
+}
+
+#endif /* __CR_SYSCALL_H__ */
\ No newline at end of file
diff -Naur criu-3.17.1/criu/pie/parasite.c criu-3.17.1.new/criu/pie/parasite.c
--- criu-3.17.1/criu/pie/parasite.c	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/criu/pie/parasite.c	2022-11-04 12:28:49.474599351 +0100
@@ -3,7 +3,6 @@
 #include <signal.h>
 #include <linux/limits.h>
 #include <linux/capability.h>
-#include <sys/mount.h>
 #include <stdarg.h>
 #include <sys/ioctl.h>
 #include <sys/uio.h>
@@ -14,6 +13,7 @@
 #include "int.h"
 #include "types.h"
 #include <compel/plugins/std/syscall.h>
+#include "linux/mount.h"
 #include "parasite.h"
 #include "fcntl.h"
 #include "prctl.h"
diff -Naur criu-3.17.1/criu/util.c criu-3.17.1.new/criu/util.c
--- criu-3.17.1/criu/util.c	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/criu/util.c	2022-11-04 12:28:49.474599351 +0100
@@ -40,6 +40,7 @@
 #include "mem.h"
 #include "namespaces.h"
 #include "criu-log.h"
+#include "syscall.h"
 
 #include "clone-noasan.h"
 #include "cr_options.h"
diff -Naur criu-3.17.1/Makefile.config criu-3.17.1.new/Makefile.config
--- criu-3.17.1/Makefile.config	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/Makefile.config	2022-11-04 12:29:13.845244516 +0100
@@ -78,7 +78,7 @@
 export CFLAGS += $(FEATURE_DEFINES)
 
 FEATURES_LIST	:= TCP_REPAIR STRLCPY STRLCAT PTRACE_PEEKSIGINFO \
-	SETPROCTITLE_INIT MEMFD TCP_REPAIR_WINDOW FSCONFIG MEMFD_CREATE OPENAT2
+	SETPROCTITLE_INIT MEMFD TCP_REPAIR_WINDOW MEMFD_CREATE OPENAT2
 
 # $1 - config name
 define gen-feature-test
diff -Naur criu-3.17.1/scripts/feature-tests.mak criu-3.17.1.new/scripts/feature-tests.mak
--- criu-3.17.1/scripts/feature-tests.mak	2022-06-23 23:53:25.000000000 +0200
+++ criu-3.17.1.new/scripts/feature-tests.mak	2022-11-04 12:28:49.474599351 +0100
@@ -137,19 +137,6 @@
 END(main)
 endef
 
-define FEATURE_TEST_FSCONFIG
-
-#include <linux/mount.h>
-
-int main(void)
-{
-	if (FSCONFIG_CMD_CREATE > 0)
-		return 0;
-	return 0;
-}
-
-endef
-
 define FEATURE_TEST_NFTABLES_LIB_API_0
 
 #include <string.h>
