# Compiling Time: 3.44 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=octave-forge
pkgver=2006.03.17
pkgrel=2
pkgdesc="A collection of custom scripts, functions and extensions for Octave."
_F_sourceforge_dirname="octave"
Finclude sourceforge
url="http://octave.sourceforge.net/"
depends=('octave>=2.1.73-3' 'gsl' 'ginac' 'qhull' 'pcre' 'libjpeg' 'libpng')
makedepends=('gcc-gfortran')
groups=('apps-extra')
archs=('i686')
# 2007.03.28 is for octave 2.9.10, not something for us
up2date="lynx -dump http://sourceforge.net/project/showfiles.php?group_id=2888|grep use_mirror|sed 's/.*-\(.*\)\.t.*/\1/;s/20070328/2006.03.17/;q'"
source=(${source[@]} fix-this-crap.patch)
sha1sums=('fca78a6eee1a2d44d2441c9ed9d3ffe3c51689de' \
          '8f241d5db0d32a0ef5fd0c0251f099fd4b606517')

## FIXME x86_64 - i686's need be some $CARCH

build()
{
	Fcd
	octavever="`octave-config --version`"
	Fpatchall
	## broken shit
	touch FIXES/NOINSTALL || Fdie
	Fmkdir usr/share/octave/${octavever}/site/m/octave-forge \
		usr/libexec/octave/${octavever}/site/oct/i686-pc-linux-gnu/octave-forge \
		usr/libexec/octave/${octavever}/site/exec/i686-pc-linux-gnu \
		usr/share/octave/${octavever}/site/octave-forge-alternatives/m \
		usr/libexec/octave/${octavever}/site/octave-forge-alternatives/oct/i686-pc-linux-gnu
	Fconf \
		--with-path=$Fdestdir \
		--with-mpath=/usr/share/octave/${octavever}/site/m/octave-forge \
		--with-opath=/usr/libexec/octave/${octavever}/site/oct/i686-pc-linux-gnu/octave-forge \
		--with-xpath=/usr/libexec/octave/${octavever}/site/exec/i686-pc-linux-gnu \
		--with-altmpath=/usr/share/octave/${octavever}/site/octave-forge-alternatives/m \
		--with-altopath=/usr/libexec/octave/${octavever}/site/octave-forge-alternatives/oct/i686-pc-linux-gnu
	make -k || Fdie
	make DESTDIR=$Fdestdir install || Fdie
	cd $Fdestdir/usr/libexec/octave/${octavever}/site/oct/i686-pc-linux-gnu/octave-forge
	Fmessage "Running strip on all *oct files.."
	/usr/bin/strip *.oct
}
# optimization OK
