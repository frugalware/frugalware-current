# Compiling Time: 2.46 SBU
# Maintainer: DeX77 <dex77@frugalware.org>


pkgname=ring-daemon
pkgver=20190828.2.36f8b01
pkgrel=3
pkgdesc="Ring is a free and universal communication platform which preserves the users' privacy and freedoms (daemon)"
archs=("x86_64")
url="https://ring.cx"
groups=("apps-extra")
depends=('libsamplerate' 'libupnp>=1.10.0' 'opendht' 'libsecp256k1' \
	'ffmpeg>=4.1' 'jack' 'dbus-c++' 'yaml-cpp' 'opus' 'jsoncpp>=1.9.2')
makedepends=('msgpack' 'systemd')
Fpkgversep="_"
_F_archive_grep="$(date --date='last month' '+%Y%m')"
_F_archive_name="ring"
up2date="Flasttar https://dl.ring.cx/ring-release/tarballs/"
source=("https://dl.ring.cx/ring-release/tarballs/ring_${pkgver}.tar.gz")
sha1sums=('d63c36cf6ac14828a4e60eea88c1a540e07c1607')
Fconfopts="     --enable-ipv6 \
		--without-natpmp"
_F_cd_path="ring-project"
_Fbuild_no_patch=yes
_F_cmake_confopts="	-DCMAKE_INSTALL_PREFIX=$Fdestdir/usr"
Finclude cmake

build() {
        Fcd
        Fpatchall

        #Build daemon
        Fexec mkdir -p daemon/contrib/native || Fdie
        Fexec cd daemon/contrib/native || Fdie


        Fexec ../bootstrap \
                --disable-downloads \
                --disable-all \
                --enable-pjproject
                make DEPS_pjproject= || Fdie

        Fexec cd ../..

        Fmake
        Fmakeinstall

}

# optimization OK
