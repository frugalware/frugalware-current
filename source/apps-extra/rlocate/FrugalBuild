# Last Modified: Thu, 07 Sep 2006 12:42:43 +0200
# Compiling Time: 0.07 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=rlocate
pkgver=0.5.1
pkgrel=8
pkgdesc="rlocate is an implementation of the locate command"
url="http://rlocate.sourceforge.net/"
Finclude kernel-module
depends=(${depends[@]} 'glibc' 'util-linux' 'psmisc')
options=('scriptlet' 'nofakeroot')
conflicts=('slocate')
provides=('slocate')
backup=('etc/updatedb.conf')
groups=('apps-extra')
archs=('i686')
install=$pkgname.install
Finclude sourceforge
source=(${source[@]} updatedb.conf rc.rlocated rc.rlocated-{hu,de}.po rlocate fw-do_not_add_the_group_auto)
sha1sums=('077b4c7fbc9a34117aca9907d5d1f61d4aec6190' \
          '7998e93a3c33e72e24ff3dfaeeb56d4091ade716' \
          '7156e265d18ebba1188738efb31f0d9c004881cb' \
          '84a116c81fcd6eae56d7315e0fba85b237a721af' \
          '5b7d4deeba4831390e7de66a1cc5004fd1ea88cc' \
          '4f469461d8ea24a1d33ec1913cbc00f1ab0383f1' \
          '1c8dc977a76e2eccaa9076578c3a67a53cc5e46c')

## NOTE: rlocate _CANNOT_ be builded as user
## and yes I know this looks somewhat crazy but if we don't do so we have to :
## 1) hack all Makeiles 2). add lots of Fmkdir and chmod / chown's to the build

## NOTE2: on next bump add /usr/bin/group{add,del} and see if then syncd is happy or not

build()
{
	# no Fcheckkernel, crosscompilation verified
	if ! grep -q 'rlocate' /etc/group; then
	    groupadd  -g 36 rlocate || Fdie
	    myuser=1
	fi
	Fcd
	## for non cron installs ( to be removed in 0.5.2 )
	mv install-cron.sh.in src
	Fpatch fw-do_not_add_the_group_auto
	Fbuild --with-rlocate-group=rlocate --enable-updates
	Ffilerel ../updatedb.conf /etc/updatedb.conf
	Finstallrel 0755 ../rlocate /etc/cron.daily/rlocate
	Frcd2 rlocated
	if [ "$myuser" ]; then
	    groupdel rlocate || Fdie
	fi
} 

# optimization OK
