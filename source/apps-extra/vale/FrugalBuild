# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=vale
pkgver=2.29.7
pkgrel=1
pkgdesc="A customizable, syntax-aware linter for prose"
archs=('x86_64')
groups=('apps-extra')
depends=('glibc')
_F_github_author=errata-ai
_F_github_tag_v=y
Finclude github
makedepends=('go')
sha1sums=('2c5735f04b74a3f1c1220e88922e099a05c37f3e')

build() {
	Fcd
	Fpatchall
    	export CGO_CPPFLAGS="${CPPFLAGS}"
	export CGO_CFLAGS="${CFLAGS}"
	export CGO_CXXFLAGS="${CXXFLAGS}"
	export CGO_LDFLAGS="${LDFLAGS}"
	export GOFLAGS="-buildmode=pie -trimpath -ldflags=-linkmode=external -mod=readonly -modcacherw"
	export GOPATH="${Fsrcdir}/gopath"
	export PATH="${Fsrcdir}/gopath/bin:$PATH"

	Fexec go build \
		-trimpath \
		-buildmode=pie \
		-mod=readonly \
		-modcacherw \
		-ldflags "-s -w -X main.version=\"${pkgver}\" -linkmode external -extldflags \"${LDFLAGS}\"" \
		-o bin/vale ./cmd/vale || Fdie
	Fexerel bin/vale usr/bin/vale
}


# optimization OK
