# Compiling Time: 26.46 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=glslang
pkgdesc="An OpenGL and OpenGL ES shader front end and validator"
pkgver=11.11.0
pkgrel=1
archs=(x86_64)
groups=('apps')
depends=('libstdc++>=11.3')
makedepends=('git')
options=('static')
_F_github_author=KhronosGroup
_F_github_tag=yes
_F_github_grepv="master-tot\|untagged\|candidate"
Finclude github cmake
sha1sums=('699a835c3458829ce27d17b0e35efa7a31609517')

build() {
	CXXFLAGS+=" -fno-strict-aliasing"
        CFLAGS+=" -fno-strict-aliasing"

	Fcd
	Fexec ./update_glslang_sources.py || Fdie

	# dynamic lib
	CMake_build  -DBUILD_SHARED_LIBS=ON

	# Cleanup
	Fexec cd ${Fsrcdir}/${_F_cd_path}  || Fdie
	Fexec rm -r ${_F_cmake_build_dir} || Fdie

	# static
	CMake_build

	Fmv usr/bin/spirv-remap usr/bin/remap
	Frm usr/{bin/spirv*,include/spirv-tools,lib/cmake/SPIRV-Tools*,lib/libSPIRV-*,lib/pkgconfig}
	Fmv usr/bin/remap usr/bin/spirv-remap
}
# optimization OK
