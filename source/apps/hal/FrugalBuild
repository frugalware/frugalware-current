# Compiling time: 0.44 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=hal
pkgver=0.5.9
pkgrel=3
pkgdesc="Hardware Abstraction Layer"
url="http://freedesktop.org/wiki/Software_2fhal"
depends=('dbus-glib>=0.71' 'udev>=100' 'glib2' 'libcap' 'dbus>=1.0.0' \
	'libusb' 'popt' 'pciutils' 'parted>=1.8.7' 'shadow>=4.0.18.1-2' \
	'dmidecode' 'usbutils' 'zlib')
makedepends=('pkgconfig' 'perl-xml' 'python>=2.5' 'intltool')
rodepends=('hal-info')
groups=('apps')
replaces=('submount')
options=('scriptlet')
archs=('i686' 'x86_64')
up2date="lynx -dump 'http://people.freedesktop.org/~david/dist/?C=M;O=A'|grep -v 'hal-info'|grep -v 'gnome'|grep -v PolicyKit|Flasttar"
source=(http://freedesktop.org/~david/dist/$pkgname-$pkgver.tar.gz \
	rc.hald \
	hal.conf.in.patch \
	hal-device-manager.desktop \
	ntfs-3g.patch \
	hal-allow_uid_for_ntfs.diff  \
	hal-performance_pci.ids_v5.diff \
	hal-0.5.9-parted.diff)

subpkgs=("$pkgname-device-manager")
subdescs=('GNOME based device manager for HAL')
subdepends=('python>=2.5')
subrodepends=("dbus-python pygtk gnome-python $pkgname=$pkgver")
subgroups=('gnome-extra')
subarchs=('i686 x86_64')

build()
{

	Fmkdir usr/share/applications
	Fpatchall
	Fautoreconf
	#autoreconf -v -i -f -d --warnings=all || return 1
	## TODO: figure this acpi stuff
	Fconf \
		--with-pid-file=/var/run/hald.pid \
		--with-hal-user=hald \
		--with-hal-group=hald \ \
		--with-pci-ids=/usr/share/misc \
		--with-usb-ids=/usr/share/usbutils \
		--disable-policy-kit \
		--disable-docbook-docs \
		--enable-parted \
		--with-macbookpro=no \
		--prefix=/usr \
		--datadir=/usr/share \
		--disable-acpi-acpid \
		--enable-acpi-proc \
		--enable-acl-management \
		--with-os-type=Frugalware \
		--with-backend=linux \
		--host=${CHOST} \
		--build=${CHOST}
	### BLAHHHHHHHHHHHHH
	Fmakeinstall
	Fexe /usr/share/applications/$pkgname-device-manager.desktop
	Fsplit $pkgname-device-manager usr/share/hal/device-manager
	Fsplit $pkgname-device-manager usr/share/applications
	Fsplit $pkgname-device-manager usr/bin/hal-device-manager
        Frm /etc/hotplug.d
        Fmkdir /media
	Frcd hald
}

sha1sums=('5832d97bcaf3dabb9aeb919226e3c38d366057ac'\
          'ab629a3ea7df51df48abad30731590b8e86e908f'\
          'be12d1327ca93e1830c5784f395e904b107f1947'\
          '0c4968cbb842bdae350901728d81eed9895445fa'\
          '2273e77c0c3c52aca31294b2b1a829937d0a3c18'\
          '32cd5a5043b2f817dc1d59fc98d7382fbca8a7fe'\
          '654235977c83f76433f9737f37b8a18f04136b35'\
          'b98420f8310ea83c354cb60927dd0b456bc77e49')
# optimization OK
