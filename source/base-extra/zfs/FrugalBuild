# Compiling Time: 0 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=zfs
pkgver=2.0.0
pkgrel=6
pkgdesc="ZFS"
url="http://zfsonlinux.org"
groups=('base-extra')
archs=('x86_64')
up2date="Flasttar $url"
backup=(etc/zfs/vdev_id.conf etc/zfs/zed.d/zed.rc)
Finclude kernel-module
source=(https://github.com/zfsonlinux/$pkgname/archive/$pkgname-$pkgver$pkgextraver.tar.gz
		autoconf-2.70.patch)
sha1sums=('44678b2f6a0ef1d174c96038c03f26e912f34be0' \
          'd9258cd8e84e0412bd407f078dbfb476b9fd9e92')
_F_cd_path="$pkgname-$pkgname-$pkgver$pkgextraver"
depends+=("libtirpc")

Fconfopts+="	--datarootdir=/usr/lib \
		--with-config=all \
		--disable-sysvinit \
		--with-pammoduledir=/lib/security \
		--with-systemdunitdir=/lib/systemd/system"
_Fbuild_no_patch=y

build()
{
	Fcd
	Fpatch autoconf-2.70.patch
	Fexec autoupdate -v -f || Fdie
	Fexec autoreconf -vif
	Fbuild

	Fbuild_kernelmod_scriptlet
	Fkernelver_compress_modules
	cat > $Fdestdir/etc/zfs/vdev_id.conf << EOF
# Put vdev configuration in this file.
EOF
	Frm /usr/lib/{systemd,modules-load.d}
}

# optimization OK
