# Compiling Time: 0 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=zfs
pkgver=2.1.0
pkgrel=20
pkgdesc="ZFS"
url="http://zfsonlinux.org"
groups=('base-extra')
archs=('x86_64')
up2date="Flasttar $url"
backup=(etc/zfs/vdev_id.conf etc/zfs/zed.d/zed.rc)
Finclude kernel-module
source=("https://github.com/zfsonlinux/zfs/releases/download/zfs-${pkgver}/zfs-${pkgver}.tar.gz" \
	blk_alloc_disk.patch \
	set_page_dirty.patch )

sha1sums=('84c77b472903576e80fa44573a80fdf350144612' \
          '34b9970ac75b62a3d5b3ca8f00f7f9bef639f340' \
          '470aa421eb472f52ba8a97dadafdff8a1557d533')
depends+=("libtirpc")
_Fbuild_autoreconf=true

Fconfopts+="	--datarootdir=/usr/lib \
		--with-config=all \
		--disable-sysvinit \
		--with-pammoduledir=/lib/security \
		--with-systemdunitdir=/lib/systemd/system"

build()
{
	Fcd
	Fbuild

	Fbuild_kernelmod_scriptlet
	Fkernelver_compress_modules
	cat > $Fdestdir/etc/zfs/vdev_id.conf << EOF
# Put vdev configuration in this file.
EOF
	Frm /usr/lib/{systemd,modules-load.d}
}

# optimization OK
