# Compiling Time: ~0.2 SBU
# Contributor: Miklos Vajna <vmiklos@frugalware.org>
# Maintainer: whoever <none@frugalware.org>

# TODO: implement service for iptables ipv6
#	libnetfilter_conntrack missing now

pkgname=iptables
pkgver=1.8.11
pkgrel=1
pkgdesc="IP packet filter administration"
url="https://netfilter.org"
depends=('glibc>=2.35' 'libmnl>=1.0.5' 'libnftnl>=1.2.2')
groups=('base')
archs=('x86_64')
backup=(etc/sysconfig/{firewall,iptables})
up2date="Flasttar ${url}/pub/$pkgname"
source=("${url}/pub/$pkgname/$pkgname-$pkgver.tar.xz" \
	iptables \
	firewall \
	firewall.libexec \
	firewall.service)
_F_systemd_units=(firewall=e)
Finclude systemd
sha1sums=('e5b10a1a4ebc850631d93236ae88cac207e1d7f8' \
          '57af04722d7b42f128b96119ffa97fd3924f80b1' \
          'd2d06c8cc15f5625a1d84e53ac27004f20182385' \
          '37638a0cfffa38a97b7f2bb033e3e7278fc1648a' \
          'd536cf922f1fee61c4c321a7615a2c12b96aff15')

provides=('ebtables')
replaces=('ebtables')
conflicts=('ebtables')

# As you can see, the /etc/sysconfig/firewall file was generated by
# iptables-save. I used the following commands before using iptables-save:
#
# iptables -P INPUT DROP
# # iptables -A INPUT -p tcp --dport 22 -j ACCEPT
# iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
# iptables -A INPUT -i lo -j ACCEPT

build()
{
	Fbuild \
		--with-kernel=/usr \
		--sbindir=/usr/bin \
		--enable-devel \
		--enable-libipq \
		--runstatedir=/run
	Ffile /etc/sysconfig/iptables
	Finstall 600 /etc/sysconfig/firewall
	Fexe firewall.libexec /usr/lib/$pkgname/firewall
	Ffile /usr/lib/systemd/system/firewall.service
	Fgenscriptlet
}

# optimization OK
