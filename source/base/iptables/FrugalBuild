# Compiling Time: ~0.2 SBU
# Contributor: Miklos Vajna <vmiklos@frugalware.org>
# Maintainer: whoever <none@frugalware.org>

# TODO: implement service for iptables ipv6
#	libnetfilter_conntrack missing now

pkgname=iptables
pkgver=1.8.9
pkgrel=2
pkgdesc="IP packet filter administration"
url="https://netfilter.org"
depends=('glibc>=2.35' 'libmnl>=1.0.5' 'libnftnl>=1.2.2')
groups=('base')
archs=('x86_64')
backup=(etc/sysconfig/{firewall,iptables})
up2date="Flasttar ${url}/pub/$pkgname"
source=("${url}/pub/$pkgname/$pkgname-$pkgver.tar.xz" \
	format-security.patch \
	iptables \
	firewall \
	firewall.libexec \
	firewall.service)
signatures=("${source[0]}.sig" '' '' '' '' '')
_F_systemd_units=(firewall=e)
Finclude systemd

provides=('ebtables')
replaces=('ebtables')
conflicts=('ebtables')

# As you can see, the /etc/sysconfig/firewall file was generated by
# iptables-save. I used the following commands before using iptables-save:
#
# iptables -P INPUT DROP
# # iptables -A INPUT -p tcp --dport 22 -j ACCEPT
# iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
# iptables -A INPUT -i lo -j ACCEPT

build()
{
	Fbuild \
		--with-kernel=/usr \
		--sbindir=/sbin \
		--enable-devel \
		--enable-libipq \
		--runstatedir=/run
	Ffile /etc/sysconfig/iptables
	Finstall 600 /etc/sysconfig/firewall
	Fexe firewall.libexec /usr/lib/$pkgname/firewall
	Ffile /lib/systemd/system/firewall.service
	Fgenscriptlet
}

# optimization OK
