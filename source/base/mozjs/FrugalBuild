# Compiling time: 0.17 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=mozjs
pkgver=78.15.0
pkgextraver=esr
pkgrel=1
pkgdesc="JavaScript interpreter and libraries"
url="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey"
depends=('readline' 'zlib>=1.2.12' 'libstdc++>=9.1.0-2' 'icu4c>=71.1')
makedepends=('rust' 'clang' 'clang-libs' 'llvm')
groups=('base')
archs=("x86_64")
_F_archive_grep=esr
_F_archive_grepv=91
up2date="Flastverdir https://archive.mozilla.org/pub/firefox/releases/"
source=("https://archive.mozilla.org/pub/firefox/releases/${pkgver}${pkgextraver}/source/firefox-${pkgver}${pkgextraver}.source.tar.xz" \
	0002-Fixes-for-Python-3.10.patch \
	0003-Fixes-for-Rust-1.56.patch )
signatures=("${source[0]}.asc" '' '')
options+=('static' 'clang' 'nolto')

replaces=('mozjs52' 'spidermonkey')
provides=('mozjs52' 'spidermonkey')

Fconfopts="     --with-system-zlib \
		--with-intl-api \
		--enable-shared-js \
		--disable-optimize \
		--disable-tests \
		--prefix=/usr \
		--disable-jemalloc \
		--with-system-icu"
_F_conf_configure="../js/src/configure"
_F_cd_path="firefox-$pkgver"
_Fbuild_no_patch=yes

build() {

	Fcd
	Fpatchall
	Fexec mkdir -p build || Fdie
	Fexec cd build || Fdie
	Fbuild
	Frm usr/lib/*.ajs

}



# optimization OK
