#!/bin/sh

pre_sysupgrade() {
	/usr/bin/pacman-g2 -Qe > /tmp/old-orphans                                                                                                                                                                    
}

post_sysupgrade() {
	/usr/bin/pacman-g2 -Qe > /tmp/new-orphans
	if [ -f /tmp/new-orphans ]; then
		echo "There are orphans: check with -Qe"
	elif [ $(/usr/bin/diff /tmp/old-orphans /tmp/new-orphans) ]; then
		echo "Installed packages no longer needed found:"
		/usr/bin/comm -13 /tmp/old-orphans /tmp/new-orphans
	fi
	rm -f /tmp/old-orphans /tmp/new-orphans
}

op=$1
shift
$op $*
