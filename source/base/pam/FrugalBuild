# Compiling Time: 0.08 SBU
# Maintainer: bouleetbil <bouleetbil@frogdev.info>

pkgname=pam
pkgver=1.4.0
pkgrel=1
pkgdesc="Linux-PAM (Pluggable Authentication Modules)"
archs=('x86_64')
groups=('base' 'chroot-core')
depends=('glibc>=2.29-5' 'db>=18.1.32-2')
makedepends=('flex>=2.6.4-2' 'gettext>=0.19.8.1-6' 'docbook-xsl' 'w3m')
sha1sums=('e26c6594c14680da42ea2875b60664ec159670bf' \
          '5a7fe2d9bd9b3bae41e945feb80c89f773498951' \
          'b002e58a0653798205be63ba736d885903e35bd4' \
          '39e14ce22cd4fcec39db3e1a92715768e76f397e')
_F_github_author="linux-pam"
_F_github_name="linux-pam"
_F_github_full_archive_name="Linux-PAM-$pkgver"
_F_cross32_delete=('lib/' 'usr/include/security' 'sbin/')
Finclude github cross32
source=(https://github.com/linux-pam/linux-pam/releases/download/v$pkgver/Linux-PAM-$pkgver.tar.xz \
	dont-enforce-lib64.patch \
	fix-systemd-path.patch \
	fix-test-calls.patch)
up2date="$up2date | sed 's/Linux-PAM-//g'"
_F_cd_path="Linux-PAM-$pkgver"
options=('scriptlet' 'ldgold')
_Fbuild_autoreconf=true

makedepends+=('lib32-flex>=2.6.4-2' 'lib32-gettext>=0.19.8.1-6')

subpkgs=("lib32-${pkgname}")
subdescs=("$pkgdesc ( 32bit )")
subdepends=("lib32-glibc>=2.29-5 lib32-db>=18.1.32-2")
subgroups=('lib32-extra')
subarchs=('x86_64')

Fconfopts+=" --disable-dependency-tracking --disable-prelude --libdir=/lib"
F32confopts+=" --disable-dependency-tracking --disable-prelude --libdir=/usr/lib32"

provides=('pam-headers')
conflicts=('pam-headers')
replaces=('pam-headers')

build() {

	Fcd
	Fcross32_common_build
	Fcross32_delete_empty
	Frm var/run
	Fsplit "${subpkgs[0]}" /\*

	Fcd

	Fbuild
	Ffileschmod /sbin/unix_chkpwd u+s
	Frm /var/run
	Fmkdir /etc/tmpfiles.d
cat > $Fdestdir/etc/tmpfiles.d/pam.conf << EOF
d /run/sepermit 0755 root root -
EOF
}

# optimization OK
