# Compiling Time: 0.08 SBU
# Maintainer: bouleetbil <bouleetbil@frogdev.info>

pkgname=pam
pkgver=1.5.3
pkgrel=2
pkgdesc="Linux-PAM (Pluggable Authentication Modules)"
archs=('x86_64')
groups=('base' 'chroot-core')
depends=('glibc>=2.35' 'db>=18.1.32-2' 'libaudit' 'libsystemd')
makedepends=('flex>=2.6.4-2' 'gettext>=0.19.8.1-6' 'docbook-xsl' 'w3m' 'systemd-devel')
sha1sums=('b27ea4def098bf3e4f277d6c78d42067e912cc1f')
_F_github_author="linux-pam"
_F_github_name="linux-pam"
_F_github_tag_v=y
_F_github_full_archive_name="Linux-PAM-$pkgver"
_F_cross32_delete=('lib/' 'usr/include/security' 'sbin/')
Finclude github cross32
source=(https://github.com/linux-pam/linux-pam/releases/download/v$pkgver/Linux-PAM-$pkgver.tar.xz)
backup=(etc/security/{access.conf,faillock.conf,group.conf,limits.conf,namespace.conf,namespace.init,pam_env.conf,time.conf} etc/environment)
_F_cd_path="Linux-PAM-$pkgver"
options=('scriptlet' 'ldgold')
_Fbuild_autoreconf=yes

Fconfopts+="	--with-systemdunitdir=/lib/systemd --libdir=/lib"
F32confopts+="	--libdir=/usr/lib32"

subpkgs=("lib32-${pkgname}")
subdescs=("$pkgdesc ( 32bit )")
subdepends=("lib32-glibc>=2.34 lib32-db>=18.1.32-2 lib32-libsystemd")
subgroups=('lib32-extra')
subarchs=('x86_64')

provides=('pam-headers')
conflicts=('pam-headers')
replaces=('pam-headers')

build() {

	Fcd
	Fcross32_common_build
	Fcross32_delete_empty
	Frm var/run
	Fsplit "${subpkgs[0]}" /\*

	Fcd

	Fbuild
	Ffileschmod /sbin/unix_chkpwd u+s
	Frm /var/run
	Fmkdir /etc/tmpfiles.d
cat > $Fdestdir/etc/tmpfiles.d/pam.conf << EOF
d /run/faillock 0755 root root -
EOF
}

# optimization OK
