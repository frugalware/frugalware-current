# Compiling Time: 0.02 SBU
# Maintainer: James Buren <ryuo@frugalware.org>

pkgname=tzdata
pkgver=2021b
pkgrel=1
pkgdesc="Sources for time zone and daylight saving time data"
url="http://www.iana.org/time-zones"
# Uses glibc, but do not depend on it. glibc does already.
depends=()
groups=('base' 'chroot-core')
archs=('x86_64')
Fpkgversep=""
up2date="Flasttar $url"
_F_cd_path=.
source=($url/repository/releases/${pkgname}${pkgver}.tar.gz)
sha1sums=('23f8f6880fafa938dfb442ce5352be6ba75b9609')
options=('nostrip' 'nodocs')

build()
{

	local DIR tz tab i d

	DIR="$Fdestdir/usr/share/zoneinfo"
	tz=('africa' 'antarctica' 'asia' 'australasia' 'europe' 'northamerica' 'southamerica' \
		'etcetera' 'backward' 'factory')

	## not sure why zone1970.tab is still needed but ..
	tab=('iso3166.tab' 'zone1970.tab' 'zone.tab')

	for i in "${tz[@]}"
	do
		Fexec /usr/sbin/zic -d ${DIR} ${i} || Fdie
		Fexec /usr/sbin/zic -d ${DIR}/right -L leapseconds ${i} || Fdie
		Fexec /usr/sbin/zic -d ${DIR}/posix ${i} || Fdie
	done

	for d in "${tab[@]}"
	do
		Ffile ${d} /usr/share/zoneinfo/${d}
	done

	## posixrules , localtime
	Fexec /usr/sbin/zic -d ${DIR} -p America/New_York || Fdie
	Frm usr/share/zoneinfo/localtime

}

# optimization OK
