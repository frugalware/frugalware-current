# Compiling time: 0.19 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=util-linux
pkgver=2.12
extrapkgver=r
pkgrel=30
pkgdesc="Miscellaneous system utilities for Linux"
url="http://www.kernel.org/pub/linux/utils/util-linux"
backup=('etc/sysconfig/console' 'etc/sysconfig/numlock')
depends=('bash' 'ncurses' 'zlib' 'e2fsprogs' 'texinfo')
groups=('base' 'chroot-core')
archs=('i686' 'x86_64' 'ppc')
up2date="lynx -dump '$url/?C=M;O=D'|grep util-linux-[0-9\.]*[a-z]*.tar.bz2|sed -n 's/.*-\(.*\)\.t.*/\1/;s/$extrapkgver$//;1 p'"
source=(http://www.kernel.org/pub/linux/utils/$pkgname/$pkgname-$pkgver$extrapkgver.tar.bz2 \
	frugalwaregetty numlock rc.{bootclean,console,mount,rmount,swap,time} \
	rc.bootclean-{de,hu}.po rc.mount-{de,hu}.po rc.rmount-{de,hu}.po \
	rc.swap-{de,hu}.po rc.time-{de,hu}.po \
	$pkgname-2.12r-cramfs-1.patch $pkgname-2.12r-swapon-check-symlinks.patch \
	fdisk_llseek.diff)
signatures=($source.sign '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '')

build() {
	Fcd $pkgname-$pkgver$extrapkgver
	Fpatchall
	CPUTAIL=`echo $CARCH|sed 's/^i//'`
	Fsed 'CPUTAIL=486' "CPUTAIL=$CPUTAIL" MCONFIG
	./configure

	make HAVE_SLN=yes ADD_RAW=yes || return 1

	make HAVE_SLN=yes ADD_RAW=yes DESTDIR=$Fdestdir install

	# Remove conflicting files.
	Frm /bin/kill
	Frm /usr/share/man/man1/kill.1
	Frm /usr/bin/write
	Frm /usr/share/man/man1/write.*
	Frm /usr/share/man/man5/nfs.5
	Frm /usr/bin/setfdprm

	# Init scripts.
	for i in bootclean mount rmount swap time ; do
		Frcd2 $i
	done
	Fexe /etc/rc.d/rc.console

	# Our getty.
	Fexe /sbin/frugalwaregetty
	Ffile /etc/sysconfig/numlock

	# Console config.
	echo "idle=15" > $Fdestdir/etc/sysconfig/console
}

# optimization OK
