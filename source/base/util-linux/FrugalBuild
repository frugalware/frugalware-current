# Last modified: Sat, 04 Mar 2006 02:34:38 +0100
# Compiling time: 0.09 SBU
# Maintainer: VMiklos <mamajom@axelero.hu>
# Modified by Laszlo Dvornik <dvornik@gnome.hu>

pkgname=util-linux
pkgver=2.12
extrapkgver=r
pkgrel=22
pkgdesc="Miscellaneous system utilities for Linux"
backup=('etc/sysconfig/console' 'etc/sysconfig/numlock')
depends=('bash' 'ncurses' 'zlib' 'e2fsprogs' 'texinfo')
groups=('base' 'chroot-core')
archs=('i686' 'x86_64' 'ppc')
install=$pkgname.install
up2date="lynx -dump 'http://www.kernel.org/pub/linux/utils/util-linux/?C=M;O=D'|grep util-linux-[0-9\.]*[a-z]*.tar.bz2|sed -n \"s/.*-\(.*\)\.t.*/\1/;s/$extrapkgver$//;1 p\""
source=(http://www.kernel.org/pub/linux/utils/$pkgname/$pkgname-$pkgver$extrapkgver.tar.bz2 \
	frugalwaregetty numlock rc.{bootclean,console,mount,rmount,swap,time} \
	rc.bootclean-{de,hu}.po rc.mount-{de,hu}.po rc.rmount-{de,hu}.po \
	rc.swap-{de,hu}.po rc.time-{de,hu}.po timeconfig timeconfig.{en,hu} \
	$pkgname-2.12r-cramfs-1.patch $pkgname-2.12r-swapon-check-symlinks.patch)
sha1sums=('740b7eb5ae1148b2200b2cd34a0a6c4b0db577e4' \
	  'c30c963eb435235ede1e507599da92c37c66c528' \
	  'cf32c54ca7f4ca3b7a91ebe309f114ed4d296a09' \
	  '9044d2271542da56f51041bbd4fe18fa153f8dd1' \
	  '9fe933e45a41a64958b3e5693f20bda35f3f1a99' \
	  'da4d5a807cde1da5e0ac937e8079c64bf8209023' \
	  '485fd3e9f763ec9770f2cb340cbbb90662576838' \
	  'c7045e453ec6ccf9cbf5c4eed964b8421c826b0c' \
	  'ddb7b23f86c06e0f9441799cb2559c01b24c0e09' \
	  '2bac91c83cce1c05dd422fba2bb7ff2eae970808' \
	  '20f4f9b32ab16fb3fd83131fff02d4efa1e211e9' \
	  '6cf5ea7b091267e840feea695ecc29f74b4aebe0' \
	  '8ece6c45af126ce43369cfdad99f92e83be6066a' \
	  '3baebb2c851fa47d999a1ea3e597c397d11cfa5f' \
	  '26177285130e86a6f2dfc9a5f382037192aa4bd9' \
	  '66138920b084abbeb2aba968cd6f05946abd8e31' \
	  'a279379495639bbc348435d53a9641c456c55fc0' \
	  '7b1dfbe76085445ff89e6f758f54d88fb4902d16' \
	  '9220a96bd23442c4a63f38edea37f9bfb8c10454' \
	  'f68b14f82e73160f52d477bc6e762f26dcafed35' \
	  'c5f44eead208132b38ca24a8a2e40b29329a99af' \
	  'e58c690ce51fa980091d1eec4e8e7197ab2c08d4' \
	  '00f5192493b939c2c996df9c1f3f769abfa3fa8c' \
	  '4c193d94340d13a0c2fa414df2e8aadf46e33456')

build() {
	Fcd $pkgname-$pkgver$extrapkgver
	Fpatchall
	CPUTAIL=`echo $CARCH|sed 's/^i//'`
	Fsed 'CPUTAIL=486' "CPUTAIL=$CPUTAIL" MCONFIG
	./configure

	make HAVE_SLN=yes ADD_RAW=yes || return 1

	make HAVE_SLN=yes ADD_RAW=yes DESTDIR=$Fdestdir install

	# Remove conflicting files.
	Frm /bin/kill
	Frm /usr/share/man/man1/kill.*
	Frm /usr/bin/write
	Frm /usr/share/man/man1/write.*
	Frm /usr/bin/setfdprm

	# Init scripts.
	for i in bootclean mount rmount swap time ; do
		Frcd2 $i
	done
	Fexe /etc/rc.d/rc.console

	# Our getty.
	Fexe /sbin/frugalwaregetty
	Ffile /etc/sysconfig/numlock

	# Console config.
	echo "idle=15" > $Fdestdir/etc/sysconfig/console

	# Timeconfig.
	Fexe /var/lib/frugalware/system/timeconfig
	Ffile timeconfig.{en,hu} /var/lib/frugalware/messages/
	Fln ../var/lib/frugalware/system/timeconfig /sbin/timeconfig
}

# optimalization OK
