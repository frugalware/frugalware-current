# Compiling Time: 0.02 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=zstd
pkgver=1.5.5
pkgrel=3
pkgdesc='Zstandard - Fast real-time compression algorithm'
archs=('x86_64')
groups=('base' 'chroot-core')
depends=('zlib>=1.2.12' 'xz>=5.2.4-2' 'lz4>=1.9.1-2')
_F_github_author="facebook"
_F_github_tag_v=y
_F_github_grepv=1.4
_F_cross32_simple_auto=y
_F_cross32_delete=('usr/bin' 'usr/include')
_F_github_ver="$pkgver$pkgextraver"
Finclude github cross32
url='http://www.zstd.net/'
source+=(asflags.patch)
sha1sums=('93f54404a63845ecf9133471275c38040954cbfe' \
          'd853747fa8c8bb5416e647d4c820951862824d21')
options+=('ldgold' 'static')
_F_cd_path="$pkgname-$pkgver$pkgextraver"

subpkgs+=("${pkgname}-static")
subdescs+=("Static files for $pkgname")
subdepends+=('')
subgroups+=('devel-extra')
subarchs+=('x86_64')
suboptions+=('')


build() {
	Fcross32_prepare
        Fcross32_copy_source
	_F_make_opts+=" PREFIX=/usr LIBDIR=/usr/lib32 PKGCONFIGDIR=/usr/lib32/pkgconfig"
	Fbuild
	Fcross32_copy_back_source
        Fcross32_reset_and_fix

	Fcross32_delete_empty
	Fcross32_delete_static
        Fsplit "${subpkgs[0]}" /\* ## everything else ignored only first one
        ## 64bit
        _F_make_opts+=" PREFIX=/usr LIBDIR=/usr/lib PKGCONFIGDIR=/usr/lib/pkgconfig"
        Fbuild

	Fexec make -C contrib/pzstd || Fdie
	Fexerel contrib/pzstd/pzstd usr/bin/pzstd

	Fsplit ${pkgname}-static usr/lib/*.a
}

# optimization OK
