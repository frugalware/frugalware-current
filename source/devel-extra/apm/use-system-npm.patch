diff -Naur apm-2.0.0/package.json apm-2.0.0.new/package.json
--- apm-2.0.0/package.json	2018-07-30 14:07:40.000000000 +0200
+++ apm-2.0.0.new/package.json	2018-07-31 09:01:34.666964165 +0200
@@ -29,11 +29,9 @@
     "fs-plus": "2.x",
     "git-utils": "^4.0",
     "hosted-git-info": "^2.1.4",
-    "keytar": "^4.0",
+    "keytar": "^4.2.1",
     "mv": "2.0.0",
     "ncp": "~0.5.1",
-    "node-gyp": "3.4.0",
-    "npm": "6.1.0",
     "open": "0.0.4",
     "plist": "git+https://github.com/nathansobo/node-plist.git",
     "q": "~0.9.7",
diff -Naur apm-2.0.0/package.json~ apm-2.0.0.new/package.json~
--- apm-2.0.0/package.json~	1970-01-01 01:00:00.000000000 +0100
+++ apm-2.0.0.new/package.json~	2018-07-31 08:55:18.000000000 +0200
@@ -0,0 +1,60 @@
+{
+  "name": "atom-package-manager",
+  "description": "Atom package manager",
+  "version": "2.0.0",
+  "license": "MIT",
+  "repository": {
+    "type": "git",
+    "url": "https://github.com/atom/apm.git"
+  },
+  "bugs": {
+    "url": "https://github.com/atom/apm/issues"
+  },
+  "main": "./lib/apm.js",
+  "bin": {
+    "apm": "./bin/apm"
+  },
+  "scripts": {
+    "build": "node script/check-version.js && grunt",
+    "prepublish": "grunt prepublish",
+    "install": "node script/postinstall.js",
+    "test": "node script/check-version.js && grunt test",
+    "check-version": "node version.js"
+  },
+  "dependencies": {
+    "asar-require": "0.3.0",
+    "async": "~0.2.8",
+    "colors": "~0.6.1",
+    "first-mate": "6.2.0",
+    "fs-plus": "2.x",
+    "git-utils": "^4.0",
+    "hosted-git-info": "^2.1.4",
+    "keytar": "^4.0",
+    "mv": "2.0.0",
+    "ncp": "~0.5.1",
+    "open": "0.0.4",
+    "plist": "git+https://github.com/nathansobo/node-plist.git",
+    "q": "~0.9.7",
+    "read": "~1.0.5",
+    "request": "^2.72.0",
+    "rimraf": "^2.5.2",
+    "season": "^6.0.2",
+    "semver": "^5.1.0",
+    "tar": "^2.2.1",
+    "temp": "^0.8.3",
+    "underscore-plus": "1.x",
+    "wordwrap": "0.0.2",
+    "wrench": "~1.5.1",
+    "yargs": "^3.23.0"
+  },
+  "devDependencies": {
+    "coffee-script": "^1.8.0",
+    "express": "~3.2.3",
+    "grunt": "^1.0.1",
+    "grunt-coffeelint": "0.0.16",
+    "grunt-cli": "^1.2.0",
+    "grunt-contrib-coffee": "^1.0.0",
+    "grunt-shell": "^1.3.0",
+    "jasmine-focused": ">=1.0.7 <2.0"
+  }
+}
diff -Naur apm-2.0.0/src/dedupe.coffee apm-2.0.0.new/src/dedupe.coffee
--- apm-2.0.0/src/dedupe.coffee	2018-07-30 14:07:40.000000000 +0200
+++ apm-2.0.0.new/src/dedupe.coffee	2018-07-31 08:54:47.178977377 +0200
@@ -17,7 +17,7 @@
     @atomPackagesDirectory = path.join(@atomDirectory, 'packages')
     @atomNodeDirectory = path.join(@atomDirectory, '.node-gyp')
     @atomNpmPath = require.resolve('npm/bin/npm-cli')
-    @atomNodeGypPath = require.resolve('node-gyp/bin/node-gyp')
+    @atomNodeGypPath = require.resolve('npm/node_modules/node-gyp/bin/node-gyp')
 
   parseOptions: (argv) ->
     options = yargs(argv).wrap(100)
diff -Naur apm-2.0.0/src/install.coffee apm-2.0.0.new/src/install.coffee
--- apm-2.0.0/src/install.coffee	2018-07-30 14:07:40.000000000 +0200
+++ apm-2.0.0.new/src/install.coffee	2018-07-31 08:54:47.364977371 +0200
@@ -84,7 +84,7 @@
     opts = {env, cwd: @atomDirectory}
     opts.streaming = true if @verbose
 
-    atomNodeGypPath = process.env.ATOM_NODE_GYP_PATH or require.resolve('node-gyp/bin/node-gyp')
+    atomNodeGypPath = process.env.ATOM_NODE_GYP_PATH or require.resolve('npm/node_modules/node-gyp/bin/node-gyp')
     @fork atomNodeGypPath, installNodeArgs, opts, (code, stderr='', stdout='') ->
       if code is 0
         callback()
