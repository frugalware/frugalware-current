# Compiling Time: 0 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=grpc
pkgver=1.30.2
pkgrel=2
_gtestver=c9ccac7cb7345901884aabf5d1a786cfa6e2f397
_abseilcppver=df3ea785d8c30a9503321a3d35ee7d35808f190d
pkgdesc="High performance, open source, general RPC framework that puts mobile and HTTP/2 first."
archs=('x86_64')
groups=('devel-extra')
url='https://grpc.io'
depends=('openssl' 'c-ares' 'protobuf>=3.13.0')
_F_github_tag_v=yes
_F_github_grepv=pre
_F_cmake_confopts="	-DgRPC_BUILD_CSHARP_EXT=OFF \
			-DgRPC_BUILD_GRPC_CSHARP_PLUGIN=OFF \
			-DgRPC_BUILD_GRPC_OBJECTIVE_C_PLUGIN=OFF \
			-DgRPC_CARES_PROVIDER=package \
			-DgRPC_PROTOBUF_PROVIDER=package \
			-DgRPC_SSL_PROVIDER=package \
			-DgRPC_ZLIB_PROVIDER=package \
			-DBUILD_SHARED_LIBS=ON"
Finclude github cmake
source+=("https://github.com/google/googletest/archive/$_gtestver/googletest-$_gtestver.tar.gz" \
	"https://github.com/abseil/abseil-cpp/archive/$_abseilcppver/abseil-cpp-$_abseilcppver.tar.gz")
sha1sums=('d5f2270c7a42154e0a5a184b3b0a9a97e90442de' \
          '201c09f9084281198d0f0ce273caed325994c95e' \
          '5782421a7c3a905bce391b184f609b23545e1667')
options=('nolto')

build() {
	Fcd
	ln -sf "F$srcdir/googletest-$_gtestver/"{googlemock,googletest} \
		third_party/googletest

	rm -rf third_party/abseil-cpp
		ln -s "$Fsrcdir/abseil-cpp-$_abseilcppver/" third_party/abseil-cpp

	# oh well..
	export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$Fsrcdir/$_F_cd_path/frugalware_cmake_build"
	CMake_build
}

	

# optimization OK
