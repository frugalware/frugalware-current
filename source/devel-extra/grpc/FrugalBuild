# Compiling Time: 0 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=grpc
pkgver=1.27.3
pkgrel=1
_gtestver=c9ccac7cb7345901884aabf5d1a786cfa6e2f397
_abseilcppver=37dd2562ec830d547a1524bb306be313ac3f2556
pkgdesc="High performance, open source, general RPC framework that puts mobile and HTTP/2 first."
archs=('x86_64')
groups=('devel-extra')
url='https://grpc.io'
depends=('openssl' 'c-ares' 'protobuf>=3.11.0')
_F_github_tag_v=yes
_F_github_grepv=pre
_F_cmake_confopts="	-DgRPC_BUILD_CSHARP_EXT=OFF \
			-DgRPC_BUILD_GRPC_CSHARP_PLUGIN=OFF \
			-DgRPC_BUILD_GRPC_OBJECTIVE_C_PLUGIN=OFF \
			-DgRPC_CARES_PROVIDER=package \
			-DgRPC_PROTOBUF_PROVIDER=package \
			-DgRPC_SSL_PROVIDER=package \
			-DgRPC_ZLIB_PROVIDER=package \
			-DBUILD_SHARED_LIBS=ON"
Finclude github cmake
source+=("https://github.com/google/googletest/archive/$_gtestver/googletest-$_gtestver.tar.gz" \
	"https://github.com/abseil/abseil-cpp/archive/$_abseilcppver/abseil-cpp-$_abseilcppver.tar.gz")
sha1sums=('ef7d83e6142f846c5f113761629b397f533ab57f' \
          '201c09f9084281198d0f0ce273caed325994c95e' \
          '38189d039607624208270312030dfafec9ae7e4a')
options=('nolto')

build() {
	Fcd
	ln -sf "F$srcdir/googletest-$_gtestver/"{googlemock,googletest} \
		third_party/googletest

	rm -rf third_party/abseil-cpp
		ln -s "$Fsrcdir/abseil-cpp-$_abseilcppver/" third_party/abseil-cpp

	# oh well..
	export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$Fsrcdir/$_F_cd_path/frugalware_cmake_build"
	CMake_build
}

	

# optimization OK
