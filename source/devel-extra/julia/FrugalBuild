# Compiling Time: 20 SBU
# Maintainer: Melko <melko@frugalware.org>


pkgname=julia
<<<<<<< HEAD
pkgver=1.7.2
pkgrel=4
pkgdesc="High-level, high-performance dynamic programming language for technical computing."
depends=('libgfortran' 'gmp' 'fftw' 'libgit2>=0.25.0' 'zlib>=1.2.12' 'llvm-libs' \
	'pcre2' 'lapack' 'utf8proc' '7zip' 'libblas' 'libatomic')
makedepends=('gcc-gfortran' 'git' 'cmake' 'patchelf' 'llvm')
=======
pkgver=1.7.3
pkgrel=1
pkgdesc="High-level, high-performance dynamic programming language for technical computing."
depends=('libgfortran' 'gmp' 'fftw' 'libgit2>=0.25.0' 'llvm' \
	'libunwind' 'pcre2' 'lapack' 'utf8proc' '7zip' 'libblas' 'libatomic')
makedepends=('gcc-gfortran' 'git' 'cmake' 'patchelf')
>>>>>>> 5d9fdffdc7d52a915502c889821386bdbc4ff7c5
groups=('devel-extra')
archs=('x86_64')
_F_github_tag_v="y"
_F_github_author="JuliaLang"
_F_gnome_iconcache="y"
<<<<<<< HEAD
_F_github_grepv="rc6\|rc5\|rc4\|rc3\|rc2\|1.0\|beta\|1.6"
Finclude github
source=(https://github.com/JuliaLang/$pkgname/releases/download/v$pkgver/$pkgname-$pkgver-full.tar.gz \
	llvm13.patch \
	julia-llvm-patchelf.patch )
sha1sums=('36f706754ef53352b3980731e1b05fea789bc495' \
          '67d70b7a52f068bc97bcc8c08dd06dc0b0f28183' \
          'e43963ce6a8bdac488f2573dabf61392fca20ac5')
=======
_F_github_grepv="rc6\|rc5\|rc4\|rc3\|rc2\|rc1\|1.0"
Finclude github
source=(https://github.com/JuliaLang/$pkgname/releases/download/v$pkgver/$pkgname-$pkgver-full.tar.gz)
sha1sums=('4ddb346099752cf1d0da32f631615d88759ff2f1')
>>>>>>> 5d9fdffdc7d52a915502c889821386bdbc4ff7c5

build() {

	Fcd
	Fpatchall

	_opts=(prefix=$Fprefix sysconfdir=/etc \
		MARCH=x86-64 \
		JULIA_BUILD_MODE=release \
		JULIA_PRECOMPILE=0 \
		USE_SYSTEM_FFTW=1 \
		USE_SYSTEM_BLAS=1 \
		USE_SYSTEM_LAPACK=1 \
<<<<<<< HEAD
		USE_SYSTEM_LIBUNWIND=0 \
=======
		USE_SYSTEM_LIBUNWIND=1 \
>>>>>>> 5d9fdffdc7d52a915502c889821386bdbc4ff7c5
		USE_SYSTEM_LLVM=1 \
		USE_SYSTEM_READLINE=1 \
		USE_SYSTEM_PCRE=1 \
		USE_SYSTEM_LIBM=0 \
		USE_SYSTEM_GMP=1 \
		USE_SYSTEM_LIBGIT2=1 \
		USE_SYSTEM_MPFR=1 \
		USE_SYSTEM_ZLIB=1 \
		USE_SYSTEM_P7ZIP=1 \
		USE_INTEL_MKL=0 \
		USE_SYSTEM_PATCHELF=1 \
		USE_LLVM_SHLIB=1)

	Fexec make ${_opts[@]} || Fdie
	Fexec make  DESTDIR=$Fdestdir ${_opts[@]} install || Fdie

	# empty
	Frm usr/libexec/
}

# optimization OK
