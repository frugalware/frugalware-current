# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=pnpm
pkgver=10.1.0
pkgrel=1
pkgdesc='Fast, disk space efficient package manager'
archs=('x86_64')
groups=('devel-extra')
url=https://pnpm.io
depends=('node-gyp')
makedepends=('nodejs')
Finclude github
up2date="$up2date | sed 's/v//g'"
source=("https://github.com/pnpm/pnpm/archive/refs/tags/v$pkgver.tar.gz" \
	"https://github.com/pnpm/pnpm/releases/download/v$pkgver/pnpm-linux-x64")
sha1sums=('b1302bb2dca4724c7c836d5112894edb62435986' \
          'c3284a64bbe15de4f9564d63d9aa42d6484bef1e')
_F_cd_path="$pkgname-$pkgver/$pkgname"

build() {
	Fexec chmod +x "$Fsrcdir/pnpm-linux-x64" || Fdie
	Fcd
	Fpatchall
	Fexec "$Fsrcdir/pnpm-linux-x64" install --frozen-lockfile || Fdie
  	Fexec "$Fsrcdir/pnpm-linux-x64" run compile || Fdie

  	local mod_dir=usr/lib/node_modules/$pkgname
  	Fln /$mod_dir/bin/$pkgname.cjs usr/bin/$pkgname
	Fln /$mod_dir/bin/pnpx.cjs usr/bin/pnpx

	Fmkdir ${mod_dir}/dist
	Fcprel bin $mod_dir
	Fcprel package.json $mod_dir
  	cd dist
	Fcprel $pkgname.cjs $mod_dir/dist
	Fcprel pnpmrc $mod_dir/dist
	Fcprel templates $mod_dir/dist
	Fcprel worker.js $mod_dir/dist
}


# optimization OK
