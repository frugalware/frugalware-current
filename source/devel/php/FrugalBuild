# Last Modified: Tue, 08 Aug 2006 18:29:00 +0200
# Compiling Time: 1.90 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=php
pkgver=5.1.4
pkgrel=10
pkgdesc="A widely-used general-purpose scripting language"
url="http://www.php.net"
backup=(etc/{php.ini,httpd/conf/modules.d/$pkgname.conf})
depends=('openssl' 'libjpeg' 'freetype2' 'libpng' 'gdbm' 'libxslt' 'curl' 'libxml2' 'libmcrypt' 'libidn')
makedepends=('apache' 'mysql' 'imap' 'postgresql' 'bzip2' 'zziplib' 'mta' 'openldap' 'tidy' 'freetds')
groups=('devel')
archs=('i686' 'x86_64')
up2date="lynx -dump http://www.php.net/downloads.php |grep 'Complete Source Code' -3|sed -n 's/.*P \(.*\)/\1/;2 p'"
source=(http://www.php.net/distributions/$pkgname-$pkgver.tar.gz \
	http://pecl.php.net/get/zip-1.0.tgz php.ini php.conf CVE-2006-2563.diff php-38322.diff)
sha1sums=('cfabe187fa1cd9c51a9e1ce8d61b6bc9f43d0016' \
          '0ac6f2d25385eb2c74af82c7a54639eb531d8414' \
          '6e79ce079b6a021f6a6c99a06aa123160a604fd7' \
          '0850ef23512a02e8460dc36f08f453d148dcd9df' \
	  '64a514947bace3681e0a8eb284778e04453aa03a' \
	  'bd55bb0d4735dfab5967166ffcbd2a7b81031101')

build()
{
	Fpatchall
	mv $Fsrcdir/zip-1.0 $Fsrcdir/$pkgname-$pkgver/ext/zip
	touch $Fsrcdir/$pkgname-$pkgver/ext/zip/*
	Fcd
	./buildconf --force
	Fmake --with-config-file-path=/etc \
		--enable-mailparse \
		--enable-bcmath=shared \
		--enable-calendar=shared \
		--enable-ftp=shared \
		--enable-gd-native-ttf \
		--enable-magic-quotes \
		--enable-posix=shared  \
		--enable-session \
		--enable-shared \
		--enable-shmop=shared \
		--enable-sysvsem=shared \
		--enable-sysvshm=shared \
		--enable-track-vars \
		--enable-trans-sid \
		--enable-safe-mode \
		--enable-sockets=shared \
		--enable-exif \
		--enable-sigchild \
                --enable-pcntl \
                --enable-memory-limit \
                --enable-sysvmsg \
                --enable-yp \
                --enable-dbx \
                --enable-mbstring \
		--without-db2 \
		--without-db3 \
		--with-apxs2 \
                --with-ttf \
		--with-bz2=shared \
		--with-freetype-dir=/usr \
		--with-gd=shared \
		--with-gdbm=shared \
		--with-jpeg-dir=/usr \
		--with-mcrypt=shared,/usr \
		--with-mysql=shared,/usr \
		--with-mysql-sock=/tmp/mysql.sock \
		--with-openssl \
		--with-gettext \
		--with-pear=/usr/share/pear \
		--with-dom \
		--with-dom-xslt \
		--with-png-dir=/usr \
		--with-regex=php \
		--with-zlib \
		--with-xsl \
		--with-pgsql=shared \
		--with-pgsql-sock=/tmp/pgsql.sock \
		--with-mysqli \
		--with-curl=/usr/bin \
		--with-xmlrpc \
		--with-imap=shared \
		--with-imap-ssl=shared \
		--with-zip \
		--with-zip=shared \
		--with-tidy \
		--with-tidy=shared \
		--with-ldap=shared \
		--with-mssql=shared

	## NOTE: if you add options to Fmake then 'pls' add --enable-foo to enable selection and so on
	##	 so we know wtf is enabled/with or even without thx -- crazy --
	## NOTE2: we still need sort some stuff , we are missing some apps , some could be added and
	##        some need s/--enable-foo/--with-foo/ syntax changed. I'll try to figure this -- crazy --
	Fmkdir /usr/lib/apache
	Fsed "-i -a -n php5" "-i -n php5" Makefile
	make INSTALL_ROOT=$Fdestdir EXTENSION_DIR=/usr/lib/php install || return 1

	Fsed "$Fdestdir" "" $Fdestdir/usr/{bin/pear,share/pear/pearcmd.php}

	Ffile /etc/httpd/conf/modules.d/$pkgname.conf
	Ffile /etc/php.ini
	Fln /etc/php.ini /usr/lib/php.ini
	Fmv /man /usr/
}

# optimization OK
