From 0c1e9da8a92181c7cc8630b456914a736c2e73b8 Mon Sep 17 00:00:00 2001
From: sickcodes <info@sick.codes>
Date: Mon, 30 Nov 2020 19:30:02 +0000
Subject: [PATCH] Added support for 5.10 by applying @abucodonosor's patch
 found in #234.

(cherry picked from commit 610bf413b4e475a955c632b9d9048ddb92579a24)
---
 module/evdi_gem.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/module/evdi_gem.c b/module/evdi_gem.c
index cc411b9..c0844ed 100644
--- a/module/evdi_gem.c
+++ b/module/evdi_gem.c
@@ -305,7 +305,10 @@ evdi_prime_import_sg_table(struct drm_device *dev,
 struct sg_table *evdi_prime_get_sg_table(struct drm_gem_object *obj)
 {
 	struct evdi_gem_object *bo = to_evdi_bo(obj);
-
-	return drm_prime_pages_to_sg(bo->pages, bo->base.size >> PAGE_SHIFT);
+	#if KERNEL_VERSION(5, 10, 0) <= LINUX_VERSION_CODE
+		return drm_prime_pages_to_sg(obj->dev, bo->pages, bo->base.size >> PAGE_SHIFT);
+	#else
+		return drm_prime_pages_to_sg(bo->pages, bo->base.size >> PAGE_SHIFT);
+	#endif
 }
 
