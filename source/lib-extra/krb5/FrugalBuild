# Compiling time: 0.93 SBU
# Maintainer: Michel Hermier <hermier@frugalware.org>

pkgname=krb5
pkgver=1.7
pkgrel=6
pkgdesc="Kerberos: The Network Authentication Protocol"
url="http://web.mit.edu/kerberos/"
license="MIT licence"
depends=('e2fsprogs' 'db' 'openssl>=1.0.0')
makedepends=('perl')
#makedepends=('postgresql>=8.2.1' 'mysql>=5.1.34')
rodepends=("libkrb5=$pkgver")
archs=('i686' 'ppc' 'x86_64')
groups=('lib-extra')
up2date="echo $pkgver"
source=(http://web.mit.edu/kerberos/dist/$pkgname/$pkgver/$pkgname-$pkgver-signed.tar \
	CVE-2010-0628.patch openssl.diff)
sha1sums=('0fe1b1cf9f8d4f5f5d7fdaf89326baf5c5adbc66' \
          'cf5c69909e5f1edc745f222f62f6dc676a150778' \
          'b35d8c4ec016d49a015f002e9345c23ae31126d2')
#signature=($source.asc)
#signatures=(http://web.mit.edu/kerberos/www/$pkgname-$pkgver/$pkgname-$pkgver.sig)

subpkgs=('libkrb5')
subdescs=('krb5 libraries files.')
subdepends=('e2fsprogs db libgssglue')
subgroups=('lib')
subarchs=('i686 ppc x86_64')

build() {
	Fextract $pkgname-$pkgver.tar.gz
	Fcd $pkgname-$pkgver/src
	export CPPFLAGS="$CPPFLAGS -I/usr/include/et"
	Fbuild --with-system-et --with-system-ss
	# --with-system-db

	for i in ftp rcp rlogin rsh telnet; do
		Fmv usr/bin/$i usr/bin/k$i
		Fmv usr/share/man/man1/$i.1 usr/share/man/man1/k$i.1
	done

	for i in ftpd telnetd; do
		Fmv usr/sbin/$i usr/sbin/k$i
		Fmv usr/share/man/man8/$i.8 usr/share/man/man8/k$i.8
	done

	Fsplit libkrb5 usr/lib/libgssapi_krb5.so*
	Fsplit libkrb5 usr/lib/libk5*
	Fsplit libkrb5 usr/lib/libkrb5.so.*
	Fsplit libkrb5 usr/lib/libkrb5support*
#	Fsplit libkrb5 usr/include
	Fsplit libkrb5 usr/share/examples/krb5
}

# optimization OK
