# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=openblas
pkgver=0.3.20
pkgrel=3
pkgdesc="An optimized BLAS library based on GotoBLAS2 1.13 BSD"
archs=('x86_64')
groups=('lib-extra')
url="https://www.openblas.net/"
depends=('libgomp')
makedepends=('perl' 'gcc-gfortran')
_F_github_author=xianyi
_F_github_name=OpenBLAS
_F_github_tag_v=y
Finclude github
sha1sums=('45ec54b75f53f5b704250e60bd8e82a49b430619')
_F_cd_path="OpenBLAS-$pkgver"
provides=('libblas')
conflicts=('libblas')

build() {
  Fcd
  Fexec make NO_STATIC=1 NO_LAPACK=1 NO_LAPACKE=1 NO_CBLAS=1 NO_AFFINITY=1 USE_OPENMP=1 \
       CFLAGS="$CPPFLAGS $CFLAGS" TARGET=CORE2 DYNAMIC_ARCH=1 \
       NUM_THREADS=64 MAJOR_VERSION=3 libs shared || Fdie

  Fexec make PREFIX="$Fdestdir"/usr NUM_THREADS=64 MAJOR_VERSION=3 install || Fdie
  Frm usr/include/cblas.h
  Frm usr/include/lapack*

  Fln libopenblasp-r$pkgver.so usr/lib/libblas.so
  Fln libopenblasp-r$pkgver.so usr/lib/libblas.so.3
  Fln openblas.pc usr/lib/pkgconfig/blas.pc
}


# optimization OK
