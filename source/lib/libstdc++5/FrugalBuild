# Compiling Time: 2.46 SBU
# Maintainer: VMiklos <vmiklos@frugalware.org>

pkgname=libstdc++5
pkgver=3.3.6
pkgrel=1
pkgdesc="The GNU Standard C++ Library"
url="http://gcc.gnu.org/gcc-3.3/"
depends=('binutils')
conflicts=('gcc<=3.3.6')
groups=('lib')
archs=('i686' 'x86_64')
up2date="lynx -dump $url |grep 'GCC.*[0-9]$' |sed -n 's/.*C \(.*\)/\1/;1 p'"
source=(ftp://gcc.gnu.org/pub/gcc/releases/gcc-$pkgver/gcc-$pkgver.tar.bz2 \
	gcc-3.4.3-no_multilib_amd64.patch0)
# ftp://gcc.gnu.org/pub/gcc/releases/gcc-$pkgver/md5.sum
sha1sums=('2cc43978bb09af6c2ccfdf74797d10d7cc2596fb' \
          '883ae944eb9aeca85d9adc54b3e16eab8f4a51c3')
[ "$CARCH" == "x86_64" ] && flags="--libdir=/usr/lib --disable-multilib"

# TODO: make this a subpkg of the gcc-3.3 pkg

build()
{
	Fcd gcc-$pkgver
	if [ "$CARCH" == "x86_64" ]; then
		Fpatchall
		# gcc 3.3 doesn't support -march=k8, so xgcc will fail
		export CFLAGS="-O2 -pipe"
		export CXXFLAGS="-O2 -pipe"
	fi
	mkdir ../$pkgname-build
	cd ../$pkgname-build
	../gcc-$pkgver/configure --prefix=/usr --enable-shared \
		--enable-languages=c++ --enable-threads=posix \
		--enable-__cxa_atexit $flags
	
	make all-target-libstdc++-v3 BOOT_CFLAGS="$CFLAGS" || return 1
	
	make DESTDIR=$Fdestdir install-target-libstdc++-v3
	Frm /usr/include
	Frm /usr/lib/libstdc++.{a,la,so} /usr/lib/libsupc++.{a,la}
	Frm '/usr/share/locale/*/LC_MESSAGES/libstdc++.mo'
}

# optimalization ok

# vim: ft=sh
