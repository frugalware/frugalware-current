# Compiling Time: 1.24 SBU
# Maintainer: DeX77 <dex77@frugalware.org>
# Contributor: gholafox <gholafox@free.fr>

pkgname=protobuf
pkgver=22.0
pkgrel=2
pkgdesc="Protocol Buffers are a way of encoding structured data in an efficient yet extensible format"
_F_github_author="google"
_F_github_tag_v=y
_F_github_grepv="rc1\|rc2\|rc3"
_F_cmake_confopts+="	-Dprotobuf_BUILD_TESTS=OFF \
			-Dprotobuf_BUILD_LIBPROTOC=ON \
			-Dprotobuf_BUILD_SHARED_LIBS=ON \
			-Dprotobuf_ABSL_PROVIDER=package"
Finclude github python cmake
depends=('zlib>=1.2.12' 'libstdc++>=11.3' 'abseil-cpp')
makedepends+=('curl>=7.50.3-2' 'python3-setuptools')
groups=('lib')
archs=("x86_64")
sha1sums=('ebd533c538d0a153218c9426883bb6f710f6f34a')
_F_python_version=python3

subpkgs=("protobuf-python")
subdescs=('python bindings for protobuf')
subdepends=("python3")
subrodepends=("$pkgname=$pkgver")
subgroups=('lib-extra')
subarchs=("x86_64")

build() {
	CMake_build
	export PROTOC="$PWD/protoc"
	export LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:$Fsrcdir/$_F_cd_path/${_F_cmake_build_dir}"

	Fexec cd ../python || Fdie
	Fmake
	Fmakeinstall
	# python bindings
	Fsplit protobuf-python $_F_python3_libdir
}

# optimization OK
