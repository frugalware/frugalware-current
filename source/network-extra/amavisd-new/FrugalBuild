# Compiling Time: 0.01 SBU
# Maintainer: Karoly CZOVEK <slinky@kodollak.hu>
# Contributor: Zoltan Kiss <djsmiley@inflame.hu>

pkgname=amavisd-new
pkgver=2.5.1
pkgrel=1
pkgdesc="Amavisd-new is a high-performance interface between mailer (MTA) and content checkers"
url="http://www.ijs.si/software/amavisd/"
depends=('perl-archive-tar' 'perl-archive-zip' 'perl-bdb' 'perl-convert-tnef' \
	 'perl-convert-uulib' 'perl-io-stringy' 'perl-io-zlib' \
	 'perl-mailtools' 'perl-mime-tools' 'perl-net-server' \
	 'perl-unix-syslog' 'spamassassin')
backup=('etc/amavis/20-userconf' 'etc/amavis/10-amavisconf')
groups=('network-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump $url |grep -A 2 'Most recent versions'|grep 'amavis' |sed 's/.*amavisd-new-\(.*\)\.tar.*/\1/;q'"
source=($url/amavisd-new-$pkgver.tar.gz 10-amavisconf 20-userconf \
	rc.amavisd-new amavisconf)
sha1sums=('1a93e3c773f51d2c5062ee9fc5a4b0a782758c43' \
          '648421546adab952f6ace5834c269f8a80256b84' \
          '681dea305554a05b4a7279b56c7c1282650fcb8f' \
          'b0f1274ac015a13a1ebd2cb8d4b2e001bc57f78d' \
          '0817540bbce13a5ac1861d1e82dcbcf740f977e8')
					

build() {
	
	Fcd
	Fsed "'-Home'=>'/var/amavis/db'" "'-Home'=>'/var/lib/amavis/db'" \
		amavisd-agent
	Fsed "'/var/amavis/db'" "'/var/lib/amavis/db'" amavisd-nanny
	
	Fexerel usr/sbin/amavisd
	Fexerel usr/bin/amavisd-agent
	Fexerel usr/bin/amavisd-nanny

	Fmkdir var/lib/amavis/tmp var/lib/amavis/var var/lib/amavis/db \
		var/lib/amavis/helpers var/lib/amavis/quarantine \
		var/lib/amavis/home var/lock/amavis
	Fexerel  usr/share/doc/$pkgname-$pkgver/examples/amavisd-release
	Ffilerel usr/share/doc/$pkgname-$pkgver/examples/amavisd.conf-sample 
	Ffilerel usr/share/doc/$pkgname-$pkgver/examples/amavisd.conf-default	
	Ffilerel LDAP.schema usr/share/doc/$pkgname-$pkgver/ldap/amavis.schema
	Ffilerel test-messages/* usr/share/doc/$pkgname-$pkgver/sample-messages/
	Frcd amavisd-new

	# config files
	Ffile etc/amavis/10-amavisconf
	Ffile etc/amavis/20-userconf

	# config tool
	Fexe /var/lib/frugalware/system/amavisconf
	Ffile ../messages/amavisconf.* /var/lib/frugalware/messages/
	Fmkdir /usr/sbin
	Fln ../../var/lib/frugalware/system/amavisconf /usr/sbin/amavisconf
}

# optimalization OK

# vim: ft=sh
