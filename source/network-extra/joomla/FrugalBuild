# Compiling Time: 0 SBU
# Maintainer: Bence Nagy <nagybence@tipogral.hu>

pkgname=joomla
pkgver=1.0.12
pkgrel=2
pkgdesc="One of the most powerful Open Source Content Management Systems on the planet"
url="http://www.joomla.org/"
rodepends=('apache' 'php' 'mysql' 'webappconfig')
groups=('network-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump http://www.joomla.org/content/blogcategory/32/66/|grep 'Stable version is'|sed 's/.*\[ *\([0-9.]\+\) *\]/\1/'"
backup=(var/www/joomla/configuration.php)
source=(http://ftp.frugalware.org/pub/other/sources/joomla/Joomla_"$pkgver"-Stable-Full_Package.tar.gz joomlasetup README.Frugalware \
7832.diff)
sha1sums=('3719d9b3b8ea9d32d4ad1b2ab34a2b21698718d9' \
          '436fa260a2750e2394eb23f1504757bdb8045af1' \
          'c079d041113ca5302340955027a5e313bee47f4a' \
          'f10b9f0c2b6e6bfe36574cfd6851ed300ea438e9')

build() {
	patch -p1 < 7832.diff || Fdie
	sed -i "s/#__/jos_/g" installation/sql/joomla.sql || Fdie
	sed -i "s/#__/jos_/g" installation/sql/sample_data.sql || Fdie
	Fmkdir /var/www/joomla
	mv "$Fsrcdir"/* "$Fdestdir"/var/www/joomla || Fdie
	rm "$Fdestdir"/var/www/joomla/Joomla_"$pkgver"-Stable-Full_Package.tar.gz || Fdie
	mv "$Fdestdir"/var/www/joomla/joomlasetup . || Fdie
	mv "$Fdestdir"/var/www/joomla/README.Frugalware . || Fdie
	Fexe /usr/bin/joomlasetup
	Fmv /var/www/joomla/configuration.php-dist /var/www/joomla/configuration.php
}
