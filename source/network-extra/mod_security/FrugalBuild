# Compiling Time: 0.01 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=mod_security
_F_archive_name=modsecurity
pkgver=3.0.4
pkgrel=1
pkgdesc="A security filter DSO for the popular Apache httpd server"
url="http://www.modsecurity.org"
depends=('apache>=2.4.35' 'geoip' 'owasp-modsecurity-crs' 'curl' 'apr-util' 'libxml2' 'lua>=5.4' 'yajl')
groups=('network-extra')
backup=(etc/modsecurity/modsecurity.conf etc/httpd/conf/modules.d/mod_security.conf)
archs=('x86_64')
_F_github_author="SpiderLabs"
_F_github_name=ModSecurity
_F_github_tag_v=y
Finclude github
source=("https://github.com/SpiderLabs/ModSecurity/releases/download/v$pkgver/modsecurity-v$pkgver.tar.gz" \
	lua-5.4.patch \
	$pkgname.conf)
sha1sums=('cbe8dd90800e81a3de1dc348f43d4fadb5aac88f' \
          'dfd2235978e62cc4b357d6d4f635f39bece33602' \
          'c447fb0cf589a9239574cb677b7af53c381fbda6')
_F_cd_path="modsecurity-v$pkgver"
Fconfopts+="	--enable-request-early \
		--enable-shared \
		--disable-static"

build() {

	Fcd
	Fexec ./build.sh || Fdie
	Fbuild
	## we put all in etc/modsecurity
	Fmkdir etc/modsecurity/mlogc
	## cache dir set in .conf
	Fmkdir var/cache/modsecurity
	## default confs still need be edited to do something
	Ffile $_F_cd_path/$_F_archive_name.conf-recommended /etc/modsecurity/$_F_archive_name.conf
	Ffile $_F_cd_path/mlogc/mlogc-default.conf /etc/modsecurity/mlogc/mlogc-default.conf ## not sure here

	## unicode file
	Ffile $_F_cd_path/unicode.mapping /etc/modsecurity/unicode.mapping

	## apache conf .. mod is not loaded by default there is a comment to configure that thinggy first
	Ffile /etc/httpd/conf/modules.d/$pkgname.conf
}

# optimization OK
