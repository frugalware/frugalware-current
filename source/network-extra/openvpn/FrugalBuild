# Compiling Time: 0.17 SBU
# Contributor: Christian Hamar alias krix <krics@linuxforum.hu>
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=openvpn
pkgver=2.5.1
pkgrel=1
pkgdesc="A secure tunneling daemon"
url="https://www.openvpn.net"
depends=('openssl>=1.1.1' 'lzo' 'pam' 'iproute2')
makedepends=('ca-certificates' 'systemd-devel')
groups=('network-extra')
archs=('x86_64')
_F_github_tag_v=y
_F_github_grepv="beta\|rc1\|rc2\|rc3\|2.4"
Finclude github
source=(https://swupdate.openvpn.org/community/releases/$pkgname-$pkgver.tar.xz)
signatures=("${source[0]}.asc")
_F_systemd_units=(openvpn@=)
Finclude systemd

Fconfopts+="	--sysconfdir=/etc/openvpn \
		--prefix=/usr \
		--enable-iproute2 \
		--enable-systemd"
build()
{
	SYSTEMD_UNIT_DIR="/lib/systemd/system" Fbuild
	Fmkdir {/etc,/run}/openvpn /usr/share/doc/$pkgname-$pkgver /var/lib/openvpn/chroot

	Fexec cp -ar sample/sample-{config-files,keys,scripts} $Fdestdir/usr/share/doc/$pkgname-$pkgver

	# systemd tmpfiles
	Frm var/run
	Fmkdir /etc/tmpfiles.d
        cat > $Fdestdir/etc/tmpfiles.d/openvpn.conf << EOF
d /run/openvpn 0755 root root -
EOF
	Fgenscriptlet
}

# optimization OK
