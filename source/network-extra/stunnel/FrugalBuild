# Compiling Time: 0.09 SBU
# Maintainer: Miklos Vajna <vmiklos@frugalware.org>

pkgname=stunnel
pkgver=4.42
pkgrel=1mores1
pkgdesc="Universal SSL Wrapper"
url="http://www.stunnel.org/"
depends=('zlib' 'openssl>=1.0.0' 'tcp_wrappers')
rodepends=('perl')
groups=('network-extra')
archs=('i686' 'x86_64')
up2date="lynx -dump http://www.stunnel.org/?page=versions|grep -m1 'Version '|sed 's/.*Version \(.*\) released.*/\1/'"
source=(http://mirror.bit.nl/stunnel/stunnel-$pkgver.tar.gz \
	rc.stunnel README.Frugalware stunnel.service)
signatures=($source.asc '' '' '')

build()
{
	# no certificate in the fpm, thx
	Fsed '^install-data-local:' 'do-not-run-this:' tools/Makefile.in
	# no /usr/etc, /usr/var, etc
	Fsed '@prefix@' '' tools/stunnel.conf-sample.in
	Fbuild --with-tcp-wrappers
	cd tools
	Ffilerel /etc/stunnel/stunnel.cnf
	Fmkdir /var/lib/stunnel
	chown 99:99 $Fdestdir/var/lib/stunnel
	Frcd2
	# TODO submit this upstream after Frugalware-1.5
	Ffile /lib/systemd/system/stunnel.service
}

# optimization OK
