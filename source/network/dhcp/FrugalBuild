# Last Modified: Wed, 02 Aug 2006 15:09:30 +0100
# Compiling Time: ~0.2 SBU
# Contributor: VMiklos <vmiklos@frugalware.org>
# Old-Maintainer: Zsolt Szalai <xbit.lists@chello.hu>
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=dhcp
pkgver=3.0.4
pkgrel=2
pkgdesc="DHCP server and client utilities"
url="http://www.isc.org/sw/dhcp/"
depends=('glibc')
makedepends=('groff')
groups=('network')
archs=('i686' 'x86_64')
backup=('etc/dhcpd.conf' 'etc/dhclient.conf')
up2date="lynx -dump $url |grep dhcp-[0-9] |sed -ne 's/.*p-\(.*\).t.*/\1/;1 p'"
source=(ftp://ftp.isc.org/isc/$pkgname/$pkgname-$pkgver.tar.gz \
	rc.dhcpd rc.dhcpd-hu.po README.Frugalware $pkgname-$pkgver-networkmanager-fixes.patch)
sha1sums=('2efe316d69563bf2440cbb4efc2bc06ef9445db3' \
	'78b0defcc0dbdc85b947bdf9c0037b0530358a32' \
	'fd70ba41e16c15d69529eeb216be103e042f3437' \
	'0aa3103883d0df5d9aa56defb39b22966af35a60' \
	'ff249ec72b41dc0050348feb2aa205a63a857f6f')

DIRS='client common dhcpctl dst minires server omapip relay'

build()
{
	Fcd
	Fpatchall
	./configure || Fdie
	for d in $DIRS ; do
	    Fsed 'CC_OPTIONS =' "CC_OPTIONS=$CFLAGS" work.linux-2.2/$d/Makefile
	done
	make || Fdie
	Fmakeinstall INCDIR=$Fdestdir/usr/include \
		LIBDIR=$Fdestdir/usr/lib \
		USERBINDIR=$Fdestdir/usr/bin \
		BINDIR=$Fdestdir/sbin \
		ETC=$Fdestdir/etc \
		VARRUN=$Fdestdir/var/run/ \
		VARDB=$Fdestdir/var/db \
		FFMANDIR=$Fdestdir/usr/share/man/man5 \
		LIBMANDIR=$Fdestdir/usr/share/man/man3 \
		USRMANDIR=$Fdestdir/usr/share/man/man1 \
		ADMMANDIR=$Fdestdir/usr/share/man/man8 \
		CLIENTBINDIR=$Fdestdir/sbin install
	Frcd2 dhcpd

	Ffile $pkgname-$pkgver/server/dhcpd.conf /etc/dhcpd.conf
	Ffile $pkgname-$pkgver/client/dhclient.conf /etc/dhclient.conf
	Fsed "/etc/dhclient-script" "/sbin/dhclient-script" $Fdestdir/etc/dhclient.conf
	Fsed "\(.*\)" "# \1" $Fdestdir/etc/dhclient.conf
	Fmkdir /var/state/dhcp/
	touch $Fdestdir/var/state/dhcp/dhcpd.leases
	Fdoc README.Frugalware
}

# optimization OK
