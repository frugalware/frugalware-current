# Compiling Time: 6.34 SBU
# Maintainer: Christian Hamar alias krix <krics@linuxforum.hu>

pkgname=xgl
pkgver=20060505
mesaver=20060505
mesaname=Mesa-cvs
pkgrel=7
pkgdesc="OpenGL accelerated X server"
url="http://www.freedesktop.org/Software/Xgl"
groups=('x11-extra')
archs=('x86_64' 'i686')
depends=('glitz>=0.5.5_cvs' 'libxfont' 'libxdmcp' 'libxau' 'mesa-cvs' 'libxrandr' 'libxrender')
makedepends=('randrproto' 'renderproto' 'fixesproto>=4.0' 'damageproto' 'xextproto' 'xproto' 'xf86dgaproto' 'xf86miscproto' \
	     'xf86rushproto' 'xf86vidmodeproto' 'xf86bigfontproto' 'compositeproto' 'recordproto' 'resourceproto' \
	     'videoproto' 'scrnsaverproto>=1.1.0' 'evieext' 'trapproto' 'xineramaproto' 'fontsproto' 'kbproto' 'inputproto' \
	     'bigreqsproto' 'xcmiscproto' 'xf86driproto' 'libdrm' 'printproto' 'mkfontdir' 'mkfontscale' 'fontcacheproto' \
	     'sgml-common' 'util-macros' 'glproto' 'libxkbfile' 'xorg-cf-files' 'libxxf86misc' 'libxkbui' 'libxaw' 'libxpm')
up2date=$pkgver
source=(http://ftp.frugalware.org/pub/other/sources/xgl/$pkgname-$pkgver.tar.bz2 \
	http://ftp.frugalware.org/pub/other/sources/xgl/$mesaname-$mesaver.tar.bz2 \
	01-kernel-headers-fix.patch \
	02-access_c_skip_null_addresses.patch \
	03-black-background.patch \
	autogen-no-run-configure.patch \
	README.Frugalware fw-xgl-control)
sha1sums=('65f14bbccdb080512a19131522f51602e4501ca9' \
	  '5ea5b7a76de393098e0171e4e2a48a7969a5356c' \
	  'f31702e0029b2d68018598e73ed55c4d6c58367b' \
	  '859b98a4049400be152032fc09ceff2afe9e6dcf' \
	  '863ad92892785c3785b122bf54d0def4d4d2732c' \
	  '9080a863743aa22710edb4ca5e5552b48db00e6f' \
	  '4549a22a758a0beaa0b13af5b63fc6b8e98fd6dc' \
	  '12b9ef1d31b058f484d5ade0d8a987b7e2579c92')

build() {
	Fpatchall

	./autogen.sh || Fdie

	Fmake --disable-static \
		--enable-ipv6 \
		--prefix=/usr \
		--sysconfdir=/etc/X11 \
		--localstatedir=/var \
		--with-xkb-output=/var/lib/xkb \
		--enable-multibuffer \
		--with-mesa-source=$Fsrcdir/$mesaname-$mesaver \
		--with-vendor-web="http://www.frugalware.org" \
		--with-os-name="Linux" \
		--with-os-vendor="Frugalware" \
		--enable-glx \
		--enable-dri \
		--enable-xgl \
		--enable-xglx \
		--enable-xkb \
		--disable-xprint \
		--disable-xorg \
		--disable-xvfb \
		--disable-xnest \
		--disable-dmx
	Fmakeinstall

	# conflicts with xorg-server
	Frm usr/share/aclocal/xorg-server.m4
	Frm usr/lib/xserver/SecurityPolicy
	Frm usr/lib/pkgconfig/xorg-server.pc
	Frm usr/share/man
	Frm var/lib/xkb/README.compiled

	# Remove misplaced headers :)
	rm $Fdestdir/exa.h
	rm $Fdestdir/randrstr.h
	
	Fmkdir /usr/sbin
	Fexe fw-xgl-control /usr/sbin/
}

# optimization OK
