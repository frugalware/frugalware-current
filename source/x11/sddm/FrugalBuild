# Compiling Time: 0.50 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

### FIXME: figure rodepends()

pkgname=sddm
pkgver=0.19.0
pkgrel=3
pkgdesc='QML based X11 display manager'
archs=('x86_64')
groups=('x11')
depends=('qt5-declarative>=5.13.1' 'libxau' 'libsystemd>=242-4') # can be disabled
rodepends=('xauth' 'hack')
makedepends+=('docutils' 'x11-protos' 'qt5-tools>=5.13.1' 'extra-cmake-modules' 'systemd-devel' 'systemd')
_F_cmake_confopts+="	-DCMAKE_INSTALL_PREFIX=/usr \
		        -DCMAKE_BUILD_TYPE=Release \
		        -DCMAKE_INSTALL_LIBEXECDIR=/usr/lib/sddm \
		        -DBUILD_MAN_PAGES=ON"
_F_github_author="sddm"
_F_github_tag_v=y
_F_archive_grepv="0.1.0"
Finclude github cmake
options+=('scriptlet' 'ofast')

source+=(20-frugalware-sddm.conf \
	pam-faillock.patch \
	sddm-desktop-session.patch \
	00-sddm-fix-race-pre.patch \
	01-sddm-fix-race.patch \
	03-sddm-fix-build.patch \
	xsession-dir.patch )
sha1sums=('22625b2391101773eaeb000eaebeba2b8608eef4' \
          '2ebc523dd8dd6826581099ff048fd2daaede08ac' \
          'c413bb12de84843c08f0320f38a1d23147bac958' \
          '9c449c74e5832735e7850b6ecb43d6ea66abcada' \
          'ad7f383b27c6788c0058ed19f37e019e85002a26' \
          '07b98c87df84a8ce65b099ba867deebf83ca1aaa' \
          '923f1e0f5873e4f3aa1cca95298307906adc4cc0' \
          '7ea1466963e5ae2e5e2bd847a7f43a0dd5ee0c87')


build() {

	Fcd
	Fsed 'Quick LinguistTools' 'Quick LinguistTools Test' CMakeLists.txt
	Fsed 'qt5_use_modules(ConfigurationTest Test)' 'target_link_libraries(ConfigurationTest Qt5::Core Qt5::Test)' test/CMakeLists.txt
	CMake_build
	## as long we have everything in $vendor dir this one
	## cannot be in the package since it will kill any value set in $vendor one!!
	Frm etc/sddm.conf
	Finstall 755 /usr/lib/sddm/sddm.conf.d/20-frugalware-sddm.conf

}
# optimization OK
