# Compiling Time: 1.13 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=graphicsmagick
pkgver=1.1.7
pkgrel=3
pkgdesc="A collection of tools and libraries for many image formats"
depends=('libxext' 'libsm' 'lcms' 'freetype2' 'libxml2' 'bzip2' 'jasper>=1.900.0' 'libpng' 'perl' 'urw-fonts' 'xespgs')
groups=('xapps-extra')
archs=('i686' 'x86_64')
_F_sourceforge_dirname="$pkgname"
_F_sourceforge_name="GraphicsMagick"
_F_sourceforge_ext=".tar.bz2"
Finclude sourceforge
source=($source graphicsmagick-1.1.7-overflow.patch0 \
	graphicsmagick-libpng.patch \
	CVE-2006-5456.patch)
url="http://www.graphicsmagick.org/"
_F_cd_path="GraphicsMagick-$pkgver"
sha1sums=('b2d3878be34e6d0a8a19e991b7f99da30b02df7e' \
          'ae474ea3348a7d08c7c1026a34a5cf9f37170305' \
          '6944c767dd885e6356c29dd21ae717327c42d9a0' \
          'b2dfffdb603b2e3526c2af49790a67432230a60f')

subpkgs=("$pkgname-docs")
subdescs=('GraphicsMagick Documentation')
subdepends=("$pkgname=$pkgver")
subgroups=('xapps-extra')
subarchs=('i686 x86_64')

build()
{
	Fbuild \
		--disable-dependency-tracking --with-modules --without-fpx \
		--with-gs-font-dir=/usr/share/ghostscript/fonts \
		--enable-shared --with-threads --with-quantum-depth=32
	Frm  /usr/share/GraphicsMagick-$pkgver/*.txt
	Fmkdir usr/share/doc/$pkgname-$pkgver
	Fmv /usr/share/GraphicsMagick-$pkgver/www /usr/share/doc/$pkgname-$pkgver/
	Fsplit $pkgname-docs usr/share/doc/$pkgname-$pkgver/www
}

# optimization OK
