# Compiling Time: 0.76 SBU
# Maintainer: Anthony Jorion <pingax@frugalware.org>
# Contributor: gholafox <gholafox@free.fr>

pkgname=mumble
pkgver=1.2.16
pkgrel=1
pkgdesc="A voice chat application similar to TeamSpeak"
rodepends=('qt4-plugin-sqlite3')
depends=('protobuf>=3.0.0' 'avahi-compat>=0.6.31-7' 'libqtdbus>=4.8.7-2' 'speex>=1.2rc2-4' \
	'libsndfile>=1.0.26-2' 'libqtsql>=4.8.7-2' 'libqtnetwork>=4.8.7-2' 'avahi>=0.6.31-7')
makedepends=('x11-protos' 'pkgconfig' 'libx11' 'qt4-linguist' 'libqtgui>=4.8.7-2' 'boost>=1.60.0' 'mesa-libgl-headers')
options=('scriptlet')
_F_gnome_iconcache="y"
_F_github_author="mumble-voip"
_F_github_tag=y
Finclude github gnome-scriptlet
groups=('xapps-extra')
archs=('i686' 'x86_64')
source=("https://github.com/mumble-voip/mumble/releases/download/$pkgver/mumble-$pkgver.tar.gz")
sha1sums=('175eb9d5f12143458a54cadc946c56cc40d144de')

build() {
  Fcd

    # Building mumble
  /usr/bin/qmake main.pro \
    CONFIG+="bundled-celt no-bundled-speex no-speechd no-g15 no-xevie no-server \
    no-embed-qt-translations packaged no-oss" \
    DEFINES+="PLUGIN_PATH=/usr/lib/mumble" || Fdie
  make release || Fdie

  # bin stuff
  Fexerel ./release/$pkgname usr/bin/$pkgname
  Fexerel ./scripts/$pkgname-overlay usr/bin/$pkgname-overlay

  # lib stuff
  Fmkdir usr/lib/$pkgname/
  Fexerel ./release/libmumble.so.$pkgver usr/lib/$pkgname/
  Fln libmumble.so.$pkgver usr/lib/$pkgname/libmumble.so
  Fln libmumble.so.$pkgver usr/lib/$pkgname/libmumble.so.1
  Fln libmumble.so.$pkgver usr/lib/$pkgname/libmumble.so.1.2
  Fexerel ./release/plugins/liblink.so usr/lib/$pkgname/
  #Fexerel ./release/plugins/libcelt* usr/lib/$pkgname/

  # other stuff
  Finstallrel 644 ./scripts/$pkgname.desktop usr/share/applications/$pkgname.desktop
 Finstallrel 644 ./man/mum* usr/share/man/man1/
 Finstallrel 644 ./icons/$pkgname.svg usr/share/icons/hicolor/scalable/apps/$pkgname.svg
  Fbuild_gnome_scriptlet
}

# optimization OK
