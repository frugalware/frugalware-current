# Compiling Time: 4.66 SBU
# Contributor: Massimo Chiappini
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=mythplugins
_mythtvver=0.20.2
pkgver=0.20.2
pkgrel=2
url="http://mythtv.org/"
pkgdesc="All the official MythTV plugins."
makedepends=("mythtv>=${_mythtvver}" 'libmad' 'libid3tag' 'libvorbis' 'flac>=1.1.3' 'libcdaudio' 'cdparanoia' \
	'libexif' 'kdelibs' 'sdl' 'fftw' 'faac' 'festival' 'speech_tools')
depends=()
groups=('xapps-extra')
archs=('i686' 'x86_64')
source=(http://ftp.osuosl.org/pub/mythtv/mythplugins-$pkgver.tar.bz2)
up2date="lynx -dump http://ftp.osuosl.org/pub/mythtv/ |grep mythplugins|Flasttarbz2"
sha1sums=('b227fc1f90faeb4fb950eef39c80981fecfba027')

subpkgs=('mytharchive' 'mythbrowser' 'mythcontrols' 'mythdvd' \
	'mythflix' 'mythgallery' 'mythgame' 'mythmusic' \
	'mythnews' 'mythphone' 'mythvideo' 'mythweather' 'mythweb')
subdescs=('MythTV plugin that lets you create DVDs from or archive your recorded shows.' \
	'Mini web browser for MythTV.' \
	'Experimental controls for MythTV.' \
	'DVD playback and ripping plugin for MythTV.' \
	'Netflix access plugin for MythTV.' \
	'Image gallery plugin for MythTV.' \
	'Emulation plugin for MythTV.' \
	'Music playing plugin for MythTV.' \
	'News checking plugin for MythTV.' \
	'Plugin that allows phone calls to be made to MythTV.' \
	'Video playback and browsing plugin for MythTV.' \
	'Weather checking plugin for MythTV.' \
	'Web interface for MythTV backend')
subdepends=("mythtv>=${_mythtvver}" "mythtv>=${_mythtvver} kdelibs" "mythtv>=${_mythtvver}" "mythtv>=${_mythtvver}" \
	"mythtv>=${_mythtvver}" "mythtv>=${_mythtvver} libexif" "mythtv>=${_mythtvver}" \
	"mythtv>=${_mythtvver} fftw sdl libmad libid3tag libvorbis flac>=1.1.3 libcdaudio cdparanoia" \
	"mythtv>=${_mythtvver}" "mythtv>=${_mythtvver}" "mythtv>=${_mythtvver}" "mythtv>=${_mythtvver}" \
	"mythtv>=${_mythtvver}")
subgroups=('xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' \
	'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra')
subarchs=('i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' \
	'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64' 'i686 x86_64')

rodepends=${subpkgs[@]}

build() {
	Fpatchall
	Fconf --enable-all
	qmake mythplugins.pro || Fdie
	make || Fdie
	Fmakeinstall INSTALL_ROOT=$Fdestdir

	# common part of the split
	for pkg in $(seq 0 $((${#subpkgs[@]} - 2))); do
		if [ -e ${Fdestdir}/usr/lib/mythtv/plugins/lib${subpkgs[${pkg}]}.so ]; then
			Fsplit ${subpkgs[${pkg}]} usr/lib/mythtv/plugins/lib${subpkgs[${pkg}]}.so
		fi
		Fsplit ${subpkgs[${pkg}]} usr/share/mythtv/i18n/${subpkgs[${pkg}]}*
		if [ -d ${Fdestdir}/usr/share/mythtv/${subpkgs[${pkg}]} ]; then
			Fsplit ${subpkgs[${pkg}]} usr/share/mythtv/${subpkgs[${pkg}]}
		fi
	done

	# mytharchive
	Fsplit mytharchive usr/bin/mytharchivehelper
	Fsplit mytharchive usr/share/mythtv/archive*
	Fsplit mytharchive usr/share/mythtv/themes/default/ma_*
	#Fsplit mytharchive usr/share/mythtv/archivemenu.xml
	Fsplit mytharchive usr/share/mythtv/themes/default/mythburn-ui.xml
	Fsplit mytharchive usr/share/mythtv/themes/default/mythnative-ui.xml
	Fsplit mytharchive usr/share/mythtv/themes/default/mytharchive-ui.xml

	# mythbrowser
	Fsplit mythbrowser usr/bin/mythbrowser
	Fsplit mythbrowser usr/lib/mythtv/plugins/libmythbookmarkmanager.so
	Fsplit mythbrowser usr/share/mythtv/themes/default/webpage.png

	# mythcontrols
	Fsplit mythcontrols usr/share/mythtv/themes/default/kb-button-on.png
	Fsplit mythcontrols usr/share/mythtv/themes/default/kb-button-off.png
	Fsplit mythcontrols usr/share/mythtv/themes/default/controls-ui.xml

	# mythdvd - FIXME: rc.mtd
	Fsplit mythdvd usr/share/mythtv/themes/default/md_*
	Fsplit mythdvd usr/share/mythtv/themes/default/dvd-ui.xml
	Fsplit mythdvd usr/share/mythtv/dvd_settings.xml
	Fsplit mythdvd usr/share/mythtv/dvdmenu.xml
	Fsplit mythdvd usr/bin/mtd

	# mythflix
	Fsplit mythflix usr/share/mythtv/netflix_menu.xml
	Fsplit mythflix usr/share/mythtv/themes/default/netflix-ui.xml
	Fsplit mythflix usr/share/mythtv/themes/default/title_netflix.png
	Fsplit mythflix usr/share/mythtv/themes/default/news-info-bg.png
	#Fsplit mythflix usr/share/mythtv/mythflix/scripts/netflix.pl
	#Fsplit mythflix usr/share/mythtv/mythflix/netflix-rss.xml

	# mythgallery
	Fsplit mythgallery usr/share/mythtv/themes/default/gallery*

	# mythgame
	Fsplit mythgame usr/share/mythtv/themes/default/game-ui.xml
	Fsplit mythgame usr/share/mythtv/game_settings.xml

	# mythmusic - FIXME: AAC support
	Fsplit mythmusic usr/share/mythtv/themes/default/mm*
	Fsplit mythmusic usr/share/mythtv/themes/default/*button*
	Fsplit mythmusic usr/share/mythtv/themes/default/music*
	Fsplit mythmusic usr/share/mythtv/themes/default/selectionbar.png
	Fsplit mythmusic usr/share/mythtv/themes/default/track_info_background.png
	Fsplit mythmusic usr/share/mythtv/musicmenu.xml
	Fsplit mythmusic usr/share/mythtv/music_settings.xml

	# mythnews
	Fsplit mythnews usr/share/mythtv/themes/default/news*
	#Fsplit mythnews usr/share/mythtv/mythnews/news-sites.xml

	# mythphone - FIXME: festival support
	Fsplit mythphone usr/share/mythtv/themes/default/mp*
	Fsplit mythphone usr/share/mythtv/themes/default/phone.png
	Fsplit mythphone usr/share/mythtv/themes/default/webcam-ui.xml
	Fsplit mythphone usr/share/mythtv/themes/default/phone-ui.xml

	# mythvideo
	Fsplit mythvideo usr/share/mythtv/themes/default/mv*
	Fsplit mythvideo usr/share/mythtv/themes/default/video-ui.xml
	Fsplit mythvideo usr/share/mythtv/video_settings.xml
	Fsplit mythvideo usr/share/mythtv/videomenu.xml

	# mythweather
	Fsplit mythweather usr/share/mythtv/themes/default/mw*
	Fsplit mythweather usr/share/mythtv/themes/default/*cloudy*
	Fsplit mythweather usr/share/mythtv/themes/default/lshowers.png
	Fsplit mythweather usr/share/mythtv/themes/default/flurries.png
	Fsplit mythweather usr/share/mythtv/themes/default/fog.png
	Fsplit mythweather usr/share/mythtv/themes/default/rainsnow.png
	Fsplit mythweather usr/share/mythtv/themes/default/sunny.png
	Fsplit mythweather usr/share/mythtv/themes/default/thunshowers.png
	Fsplit mythweather usr/share/mythtv/themes/default/fair.png
	Fsplit mythweather usr/share/mythtv/themes/default/unknown.png
	Fsplit mythweather usr/share/mythtv/themes/default/snowshow.png
	Fsplit mythweather usr/share/mythtv/themes/default/weather-ui.xml
	Fsplit mythweather usr/share/mythtv/themes/default/logo.png
	Fsplit mythweather usr/share/mythtv/themes/default/showers.png

	# mythweb
	mythwebdir="var/www/html/mythweb"
	Fmkdir ${mythwebdir}/{image_cache,php_sessions}
	cp -r ${Fsrcdir}/mythplugins-${pkgver}/mythweb/* ${Fdestdir}/${mythwebdir} || Fdie
	cp ${Fsrcdir}/mythplugins-${pkgver}/mythweb/.htaccess ${Fdestdir}/${mythwebdir} || Fdie
	Frm ${mythwebdir}/{README,TODO}
	chown -R nobody:nobody ${Fdestdir}/${mythwebdir} || Fdie
	chmod g+rw ${Fdestdir}/${mythwebdir}/{image_cache,php_sessions,data} || Fdie
	Fsplit mythweb ${mythwebdir}
}

# optimization OK
