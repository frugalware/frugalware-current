# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=pulsar
pkgver=1.101.0
pkgextraver=-beta
pkgrel=2
pkgdesc="A community-led hyper-hackable text editor, built on electron"
archs=("x86_64")
groups=('xapps-extra')
_F_github_author=pulsar-edit
_F_github_tag_v=y
_F_github_ver="$pkgver$pkgextraver"
Finclude github
up2date="$up2date | sed \"s:$pkgextraver::g\""
depends=('libxkbfile' 'ripgrep' 'libsecret')
makedepends=('yarn' 'nodejs16' 'git' 'kernel-headers' 'x11-protos')
sha1sums=('461ce6b3a72be981fa81dde6d4d730276dcb2012')
_F_desktop_exec="/usr/bin/pulsar %U"
_F_desktop_icon=pulsar
_F_desktop_categories="TextEditor;Development;"

replaces=('atom')
provides=('atom')
conflicts=('atom')

build() {
	Fmkdir opt/Pulsar

	Fcd
	Fpatchall
	Fexec yarn install || Fdie
	Fexec yarn build || Fdie
	Fexec yarn build:apm || Fdie
	Fexec yarn dist --linux --x64 deb || Fdie

	Fcprel dist/linux-unpacked/\* opt/Pulsar/

	Fln opt/Pulsar/resources/pulsar.svg usr/share/icons/hicolor/scalable/apps/${pkgname}.svg
	for size in 128x128 16x16 24x24 256x256 48x48 64x64
	do
		Finstallrel 644 resources/icons/$size.png /usr/share/icons/hicolor/$size/apps/${pkgname}.png
	done
	Fln /opt/Pulsar/resources/pulsar.sh usr/bin/$pkgname

	Fdesktop2
}

# optimization OK
