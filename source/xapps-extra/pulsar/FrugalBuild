# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=pulsar
pkgver=1.102.0
pkgrel=1
pkgdesc="A community-led hyper-hackable text editor, built on electron"
archs=("x86_64")
groups=('xapps-extra')
_F_github_author=pulsar-edit
_F_github_tag_v=y
_F_github_ver="$pkgver$pkgextraver"
Finclude github
depends=('libxkbfile' 'ripgrep' 'libsecret')
source=("$url/releases/download/v${pkgver}${pkgextraver}/Linux.${pkgver}.deb")
sha1sums=('33ad3660814111b77316ec9423ce3aab77b22ea9')
_F_desktop_exec="/usr/bin/pulsar %U"
_F_desktop_icon=pulsar
_F_desktop_categories="TextEditor;Development;"

replaces=('atom')
provides=('atom')
conflicts=('atom')

build() {
        Fexec ar x "Linux.$pkgver.deb" || Fdie
        bsdtar -xf data.tar.xz || Fdie
	Fexec  mv opt "$Fdestdir" || Fdie
	Fexec  mv usr "$Fdestdir" || Fdie

	# Cleanup specs. Remove if implemented upstream
	Fexec find "${Fdestdir}/opt/Pulsar/resources/app/ppm" -type d -name "spec" -exec rm -rf {} + || Fdie
	Fexec find "${Fdestdir}/opt/Pulsar/resources/app.asar.unpacked" -type d -name "spec" -exec rm -rf {} + || Fdie

	Fmkdir usr/share/icons/hicolor/scalable/apps
	Fcp opt/Pulsar/resources/pulsar.svg usr/share/icons/hicolor/scalable/apps/pulsar.svg

	Fmkdir usr/bin
	Ffileschmod opt/Pulsar/resources/pulsar.sh 755
	Fln /opt/Pulsar/resources/pulsar.sh usr/bin/pulsar
}

# optimization OK
