# Compiling Time: 3.96 SBU
# Maintainer: voroskoi <voroskoi@frugalware.org>

pkgname=scilab
pkgver=4.1.2
pkgrel=5
pkgdesc="Scilab is a scientific software package for numerical computations."
url="http://www.scilab.org/"
depends=('vte>=0.26.2' 'ncurses' 'libgtkhtml>=2.11.1-4' 'libgfortran' 'readline' 'libgcc' 'libxml2>=2.7.8' 'xaw3d' 'ocaml')
makedepends=('gcc-gfortran>=4.5.2-2')
groups=('xapps-extra')
archs=('i686' 'x86_64')
license="Scilab License"
options=('scriptlet')
up2date="lynx -dump http://scilabsoft.inria.fr/download/index_download.php?page=release.html |grep scilab.*-src.tar.gz |sed -ne 's/.*b-\(.*\)-src.*/\1/; 1 p'"
source=($url/download/$pkgver/$pkgname-$pkgver-src.tar.gz gcc45.patch)
sha1sums=('d3f3190bd11fe23eebec03fe9feaced0406ddfe3' \
          'fc5fa60c708be076f719ca13ce2a5a7ad0e273aa')

build() {
	Fpatchall
	Fconf --disable-static \
		--without-tk \
		--with-gtk2 \
		--with-gnu-ld \
		--with-gfortran
	Fsed "=\ -O" "=\ $CFLAGS" Makefile.incl
	unset MAKEFLAGS
	make all || Fdie
	Fsed "PREFIX=/usr" "PREFIX=$Fdestdir/$Fprefix" Makefile
	Fmakeinstall

	# Fixing symlinks
	Fln ../lib/$pkgname-$pkgver/bin/scilab /usr/bin/scilab
	Fln ../lib/$pkgname-$pkgver/bin/intersci /usr/bin/intersci
	Fln ../lib/$pkgname-$pkgver/bin/intersci-n /usr/bin/intersci-n

	Fsed "SCI=\"$Fdestdir/$pkgname-$pkgver\"" "SCI=\"/usr/lib/$pkgname-$pkgver\"" $Fdestdir/usr/lib/$pkgname-$pkgver/bin/scilab
}

# optimization OK
