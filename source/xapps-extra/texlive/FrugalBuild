# Compiling Time: 9.74 SBU
# Maintainer: Elentir <elentir@frugalware.org>

## disabled by default since 1.2GB
: ${USE_DOCS="n"}
## 100 MB lang we don't really support
: ${USE_CJK="n"}
## another one
: ${USE_GREEK="n"}
## 300 MB extra fonts ?
## someone may want to split these in more packages ?
## until then .. disabled by default
: ${USE_EFONTS="n"}

pkgname=texlive
pkgver=2020.0
_relversion=20190410
pkgextraver="-source"
pkgrel=1
pkgdesc="A complete TeX distribution"
archs=('x86_64')
depends=('t1lib' 'gd>=2.1.1' 'ncurses>=6.0-3' 'poppler>=20.08.0' 'icu4c>=67.1' 'zlib>=1.2.8' 'graphite2' 'zziplib' 'libpaper' 'harfbuzz' 'libgs' 'mpfr')
rodepends=('perl' 'texlive-kpathsea' 'texlive-ptexen' 'texlive-lua')
makedepends=('clisp' 'ffcall' 'x11-protos' 'lua-static' 'ghostscript')
url='http://tug.org/texlive/'
source=(http://ftp.math.utah.edu/pub/tex/historic/systems/texlive/2019/$pkgname-${_relversion}-source.tar.xz \
	http://ftp.math.utah.edu/pub/tex/historic/systems/texlive/2019/$pkgname-${_relversion}-texmf.tar.xz \
	http://ftp.math.utah.edu/pub/tex/historic/systems/texlive/2019/$pkgname-${_relversion}-extra.tar.xz \
	texlive-core-2019-poppler087.patch \
	texlive-20190410-dvisvgm-fix-libgs-detection.patch \
	texlive-20190410-disable-more-failing-tests.patch \
	texmf.cnf \
	texmfcnf.lua \
	09-texlive.conf)
up2date=" lynx --dump http://tug.org/svn/texlive/tags/ | grep tags/texlive- | Flastverdir | sed 's/texlive_//'"
groups=('xapps-extra')
options=('force')
_F_cd_path="texlive-${_relversion}-source"

conflicts=('tetex' 'tetex-kpathsea' "$pkgname-ptex")
provides=("${conflicts[@]}")
replaces=("${conflicts[@]}")

sha1sums=('d700878d3e19b6ad1313791dd5cef4bf0acfd675' \
          'f41c0220a096960c086173522b1ad2661980a3eb' \
          'b0938bdd466b07cabfb23cbf1c2b95f6463ea0d2' \
          '5c75601401118216741c2454b8d6fbb8cd7d3ee5' \
          'd07234c3c96b69e34697e1776960935b1225a48d' \
          'ae35d3af270523ef4415d1e66d964ed941fd7a7f' \
          '4fec5aa2a4eb504d96b802bd11376270658f923f' \
          '438b6ea0f2ee6813bed725a24313db1408189f0d' \
          'bf7ba21d45bee78657105a5f2c5e7e24b8614859')

_F_conf_configure="../configure"
Fconfopts+=" \
	--disable-native-texlive-build \
	--disable-multiplatform \
	--disable-dialog \
	--disable-psutils \
	--disable-t1utils \
	--disable-bibtexu \
	--disable-xz \
	--enable-shared \
	--disable-static \
	--with-system-zlib \
	--with-system-zziplib \
	--with-system-pnglib \
	--with-system-ncurses \
	--with-system-t1lib \
	--with-system-gd \
	--with-system-poppler \
	--with-system-xpdf \
	--with-system-freetype2 \
	--with-system-pixman \
	--with-system-cairo \
	--with-system-harfbuzz \
	--with-system-graphite \
	--with-system-icu \
	--with-system-gmp \
	--with-system-mpfr \
	--with-system-potrace \
	--with-system-libpaper \
	--with-freetype2-libdir=/usr/lib \
	--with-freetype2-include=/usr/include/freetype2 \
	--with-xdvi-x-toolkit=xaw \
	--disable-dump-share \
	--disable-aleph \
	--enable-luatex \
	--with-clisp-runtime=default \
	--enable-xindy \
	--disable-xindy-rules \
	--disable-xindy-docs"
_F_make_opts+=" -j1"

subpkgs=("$pkgname-xindy"
        "$pkgname-bibtex-extra"
        "$pkgname-misc"
        "$pkgname-formats-extra"
        "$pkgname-templates-extra"
        "$pkgname-pstricks"
        "$pkgname-sciences"
        "$pkgname-htmlxml"
        "$pkgname-graphics"
        "$pkgname-latex-extra"
        "$pkgname-lang-cyrillic"
        "$pkgname-lang-extra"
        "$pkgname-utils"
        "$pkgname-extra"
        "$pkgname-omega"
        "$pkgname-latex3"
        "$pkgname-plain"
        "$pkgname-kpathsea"
        "$pkgname-ptexen"
        "$pkgname-synctex"
	"$pkgname-lua")

subdescs=('Xindy package for TeX Live'
        'Extra Bibtex Styles for TeX Live'
        'Miscellaneous packages for TeX Live'
        'Extra Tex formats for Tex Live'
        'Extra publications templates for Tex Live'
        'Extra PsTricks packages for TeX Live'
        'Extra science packages for TeX Live'
        'XML/HTML packages for TeX Live'
        'Graphics packages for TeX Live'
        'Extra Latex packages for TeX Live'
        'Cyrillic language support for TeX Live'
        'Extra languages support for TeX Live'
        'Utilities for TeX Live'
        'Extra packages (generic, ..) for TeX Live'
        'A 16-bit extended TeX'
        'LaTeX3 packages for TeX Live'
        'Plain Tex packages for TeX Live'
        'Libkpathsea'
        'Libptexen'
        'libsynctex'
        'TeX Live Lua' )

subdepends=('ffcall libsigsegv readline>=8.0' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' '' 'zlib>=1.2.8-4' 'libgcc>=5.3.0')
subrodepends=("$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
        "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
        "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
        "$pkgname=$pkgver texlive-kpathsea texlive-ptexen texlive-synctex" "$pkgname=$pkgver" "$pkgname=$pkgver" "$pkgname=$pkgver" \
        "$pkgname=$pkgver" "" "" "" "")
subgroups=('xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' \
        'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' \
        'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xapps-extra' 'xlib' 'xlib-extra' \
	'xlib-extra' 'xlib-extra')
subarchs=('x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64' \
       'x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64' \
       'x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64' 'x86_64')
subinstall=("$pkgname-pkg-nomaps.install" "$pkgname-pkg-nomaps.install" "$pkgname-pkg.install" \
        "$pkgname-pkg-nomaps.install" "$pkgname-pkg-nomaps.install" "$pkgname-pkg-nomaps.install" \
        "$pkgname-pkg.install" "$pkgname-pkg-nomaps.install" "$pkgname-pkg.install" "$pkgname-pkg.install" \
        "$pkgname-pkg.install" "$pkgname-pkg.install" "$pkgname-pkg-nomaps.install" "$pkgname-pkg-nomaps.install" \
        "$pkgname-pkg.install" "$pkgname-pkg-nomaps.install" "$pkgname-pkg-nomaps.install" "" "" "" "")
subreplaces=("" "" "" "" "" "" "" "" "" "" "" "" "dvi2tty" "" "" "" "" "" "" "" "" )
suboptions=("force" "foce" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" "force" )


if Fuse $USE_DOCS; then
	subpkgs=("${subpkgs[@]}" "$pkgname-docs")
	subdescs=("${subdescs[@]}" "Documentation for TeX Live")
	subdepends=("${subdepends[@]}" "")
	subrodepends=("${subrodepends[@]}" "$pkgname=$pkgver")
	subgroups=("${subgroups[@]}" "docs-extra")
	subarchs=("${subarchs[@]}" 'x86_64')
	subinstall=("${subinstall[@]}" "")
	suboptions+=("force")
fi


if Fuse $USE_CJK; then
        subpkgs=("${subpkgs[@]}" "$pkgname-lang-cjk")
        subdescs=("${subdescs[@]}" "Chineese, Correan and Japaneese support for TeX Live")
        subdepends=("${subdepends[@]}" "")
        subrodepends=("${subrodepends[@]}" "$pkgname=$pkgver")
        subgroups=("${subgroups[@]}" "locale-extra")
        subarchs=("${subarchs[@]}" 'x86_64')
        subinstall=("${subinstall[@]}" "$pkgname-pkg.install")
	suboptions+=("force")
fi

if Fuse $USE_GREEK; then
        subpkgs=("${subpkgs[@]}" "$pkgname-lang-greek")
        subdescs=("${subdescs[@]}" "Greek support for TeX Live")
        subdepends=("${subdepends[@]}" "")
        subrodepends=("${subrodepends[@]}" "$pkgname=$pkgver")
        subgroups=("${subgroups[@]}" "locale-extra")
        subarchs=("${subarchs[@]}" 'x86_64')
        subinstall=("${subinstall[@]}" "$pkgname-pkg.install")
	suboptions+=("force")
fi

if Fuse $USE_EFONTS; then
        subpkgs=("${subpkgs[@]}" "$pkgname-fonts-extra")
        subdescs=("${subdescs[@]}" "Extra Fonts for TeX Live")
        subdepends=("${subdepends[@]}" "")
        subrodepends=("${subrodepends[@]}" "$pkgname=$pkgver")
        subgroups=("${subgroups[@]}" "fonts-extra")
        subarchs=("${subarchs[@]}" 'x86_64')
        subinstall=("${subinstall[@]}" "$pkgname-pkg.install")
	suboptions+=("force")
fi

subprovides=("${subreplaces[@]}")
subconflicts=("${subreplaces[@]}")


build() {
	Fcd
	Fpatchall
	Fexec rm -rf libs/cairo || Fdie

	Fexec mkdir -p work || Fdie
	Fexec cd work || Fdie

	Fconf --with-banner-add="/Frugalware Linux"
	Fmake
	Fmakeinstall

	# Copy texmf
	Fcp texlive-${_relversion}-texmf/texmf-dist usr/share/

	## remove original ls-R from texmf, that fix conflict with previous texlive
	## mkteslsr 'll restore them
	Frm usr/share/texmf-dist/ls-R

        # copy tlpkg package (needed by udpmap and fmtutil)
        Fcp texlive-${_relversion}-extra/tlpkg usr/share/

	## install the config file with correct paths for kpathsea
	Finstall 644 texmf.cnf usr/share/texmf-dist/web2c/
	Finstall 644 texmfcnf.lua usr/share/texmf-dist/web2c/

	# remove asymptote, we already have this =)
	Frm usr/share/texmf-dist/asymptote
	Frm usr/share/texmf-dist/doc/asymptote
	Frm usr/share/texmf-dist/tex/latex/asymptote
	Frm usr/share/texmf-dist/tex/context/asymptote

	local f i k j
	for f in asy xasy; do
		Frm usr/share/man/man1/$f.1
	done

	# remove xdvi, we already have this in xdvik =)
	Frm usr/share/texmf-dist/xdvi

	# This is not created by texlinks, remove it here and deal with this in .install
	Frm usr/bin/mfplain

	## Split all extra packages to a set of coherent subpkg
	## If their is too many subpkg then finding a specific tex package
	## can be a real nightmare but if their is no enough subpkg, the texlive base
	## pkg is too big.

	cd $Fdestdir || Fdie

if Fuse $USE_DOCS; then
	## Split the docs
	Fsplit $pkgname-docs usr/share/texmf-dist/doc
else
	Frm usr/share/texmf-dist/doc
fi

	## Split extra fonts
	for i in ai Asana-Math albertus allrunes antiqua antp antt apl ar archaic arev ascii astro \
	atqolive augie auncial-new aurical barcodes bayer bbding bbm bbm-macros bbold belleek \
	bera blacklettert1 boisik bookhands braille brushscr calligra carolmin-ps cherokee \
	clarendo cm-lgc cm-super cmbright cmll cmpica coronet courier-scaled cryst cyklop dancers \
	dice dictsym dingbat dozenal duerer duerer-latex ean ecc eco eiad eiad-ltx \
	elvish epigrafica epsdice esvect eulervm euxm feyn fge foekfont fonetika fourier fouriernc \
	frcursive garamond genealogy gfsartemisia gfsbodoni gfscomplutum gfsdidot gfsneohellenic \
	gfssolomos gothic greenpoint groff grotesq hands hfbright hfoldsty ifsym inconsolata \
	initials junicode kixfont knuthotherfonts kpfonts lettrgth lfb libertine \
	libris linearA logic lxfonts ly1 marigold mathabx mathdesign mnsymbol nkarta ogham optima \
	orkhun osmanian pacioli pclnfss phaistos phonetic pigpen itc punk recycle sauter \
	sauterfonts semaphor simpsons skull staves tapir tengwarscript tpslifonts trajan \
	umtypewriter univers universa venturisadf wsuipa zefonts venturis venturis2 \
	cm-unicode txfontsb xits stix oldstandard gnu-freefont gentium oldlatin doublestroke \
	esstix gust paratype adforn adfsymbols b1encoding berenisadf boondox cantarell \
	cmtiup comfortaa droid electrum everyhook fdsymbol gillcm jamtimes lato poltawski prodint \
	ptsans ptserif realscripts tfrupee urwchancal iwona kurier bbold-type1 starfont rsfso \
	ocr-b-outline ocr-b mdputu dejavu dutchcal fonts-tlwg libertine-legacy opensans libertineotf \
	mdsymbol tex-gyre-math  aspectratio bartel-chess-fonts jablantile mdsymbol mflogo \
	musixtex-fonts pxtxalfa sansmathaccent newtx ebgaramond librebaskerville newpx quattrocento \
	raleway sourcecodepro ascii-font bguq hacm ipaex-type1 sansmathfonts superiors cabin fontawesome \
	sansmathfonts schulschriften sourcesanspro aecc hacm punk-latex accanthis ale足greya anony足mous足pro \
	baskervaldx caladea carlito cinzel clearsans countriesofeurope dantelogo drm ebgaramond-maths \
	erewhon fbb fetamont fira fontmfizz gentium-tug heuristica librecaslon lobster2 marvosym \
	merriweather mintspirit newtxsf newtxtt obnov overlock playfair roboto universalis venturisold \
	venturissans venturissans2 xcharter zlmtt alegreya anonymouspro; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			if Fuse $USE_EFONTS; then
				Fsplit $pkgname-fonts-extra $j
			else
				Frm $j
			fi
		done
	done

	## extra bibtex styles
	for i in aichej amsrefs apacite apalike2 beebe bibarts bibexport bibhtml biblist bibtopic bibtopicprefix \
	bibunits cell chembst chicago chicago-annote collref compactbib custom-bib din1505 dk-bib doipubmed \
	elsevier-bib fbs figbib finbib footbib harvard harvmac ijqc inlinebib iopart-num jneurosci jurabib \
	listbib margbib multibib munich notes2bib perception pnas2009 rsc sort-by-letters splitbib swebib urlbst \
	abstyles biblatex biblatex-apa biblatex-chem biblatex-chicago-notes-dfbiblatex-dw biblatex-historian \
	biblatex-nature biblatex-philosophy biblatex-science biblatex-ieee biblatex-chicago biblatex-dw \
	biblatex-mla logreq polski adfathesis bgteubner cascadilla ksfh_nat vak babelbib usebib biblatex-bwl \
	biblatex-fiwi biblatex-juradiss biblatex-luh-ipw biblatex-musuos biblatex-nejm biblatex-swiss-legal \
	multibibliography francais-bst multibibliography oscola biblatex-caspervector biblatex-gost \
	biblatex-phys biblatex-publist biblatex-trad uni-wtal-ger uni-wtal-lin biblatex-anonymous \
	biblatex-bookinarticle biblatex-manuscripts-philology biblatex-multiple-dm biblatex-realauthor \
	biblatex-source-division biblatex-subseries biblatex-true-citepages-omit chscite citeall \
	crossrefware germbib showtags turabian turabian-formatting; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d -prune`
		for j in  $listdir ; do
			Fsplit $pkgname-bibtex-extra $j
		done
		listfile=`find usr/bin/ -name $i -type f `
		for j in  $listfile ; do
			Fsplit $pkgname-bibtex-extra $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-bibtex-extra $k
			fi
		fi
		done
	done

	## htmlxml packages
	for i in jadetex tex4ht xmltex ; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-htmlxml $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-htmlxml $k
			fi
		fi
		done
	done

	## formats packages
	for i in alatex edmac eplain mltex physe phyzzx psizzl startex texsis ytex ; do
		listdir=`find usr/share/texmf-dist/ -maxdepth 2 -name $i -type d`
		for j in  $listdir ; do
			Fsplit $pkgname-formats-extra $j
		done
	done

	## some templates
	for i in ANUfinalexam IEEEconf IEEEtran aastex acmconf acmtrans active-conf afthesis aguplus aiaa \
	ametsoc apa arsclassica asaetr ascelike beamer-FUBerlin chem-journal classicthesis confproc ebsthesis \
	economic elsevier erdc estcpmm euproposal gaceta gatech-thesis har2nat icsv ieeepes ijmart imac imtekda \
	jhep jpsj kluwer lps macqassign mentis muthesis nature nddiss nih nostarch nrc philosophersimprint \
	powerdot-FUBerlin pracjourn procIAGssymp psu-thesis ptptex revtex sageep siggraph spie stellenbosch \
	sugconf thesis-titlepage-fhac thuthesis toptesi tugboat tugboat-plain uaclasses ucdavisthesis ucthesis \
	uiucthesis umich-thesis umthesis ut-thesis uwthesis vancouver vxu york-thesis elbioimp jmlr onrannual \
	revtex4 ryethesis seuthesis soton unamthesis aomart apa6e cmpj dfgproposal elteikthesis fbithesis \
	msuthesis powerdot suftesi uafthesis uothesis uowthesis msu-thesis sapthesis przechlewski-book ejpecp \
	fcltxdoc abntex2 resphilosophica uestcthesis ebook matc3 matc3mem opteng pkuthss proposal scrjrnl \
	tabriz-thesis uadocs uestcthesis uiucredborder ulthese unswcover uspatent xcookybooky afparticle apa6 \
	bangorcsthesis brandeis-dissertation cnbwp csbulletin dccpaper dithesis ekaia elzcards feupphdteses \
	flipbook frletter gillius grundgesetze gsemthesis gzt komacv mcmthesis mugsthesis ndsu-thesis \
	pressrelease recipebook sduthesis sesamanuel sphdthesis sr-vorl thesis-ekf tudscr ucbthesis udesoftec \
	uowthesistitlepage urcls wsemclassic yathesis; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-templates-extra $j
		done
	done

	## games related packages
	for i in cchess chess chess-problem-diagrams chessboard chessfss crossword crosswrd egameps \
	go hexgame jeopardy othello psgo sgame skak skaknew sudoku sudokubundle xq xskak piano \
	othelloboard schwalbe-chess gamebook logicpuzzle rubik; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-misc $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-misc $k
			fi
		fi
		done
	done

	## music related packages
	for i in abc figbas gchords guitar harmony musictex musixflx musixtex musixlyr musixps songbook \
	musixguit gtrcrd songs guitarchordschemes leadsheets pmxchords lilyglyphs; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-misc $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-misc $k
			fi
		fi
		done
	done

	## misc packages that we don't want to see in main package
	for i in covington dramatist ecltree ednotes gb4e gmverse poemscol qobitree \
	ledmac lexikon lineno linguex liturg parallel parrun plari play fenixpar \
	qtree rtklage screenplay sides stage tree-dvips verse bbr barr \
	borceux colorsep dinat dirtree eijkhout encxvlna shade tabto-generic \
	insbox metatex mftoeps midnight multi ofs pdf-trans vrb \
	juramisc jurarsp jura juraabbrev bibleref xlop \
	historische-zeitschrift texapi xcomment variations yax bibleref-french \
	bibleref-german bibleref-parse edfnotes hausarbeit-jura latexfileinfo-pkgs \
	nowidow bibleref-lds  bibleref-mouth codicefiscaleitaliano catcodes commado \
	langcode plainpkg schemata dvgloss eledform eledmac horoscop leipzig loops rrgtrees \
	textglos fifo-stack lexref metrix phonrule thalie; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-extra $j
		done
	done

	## plain packages
	for i in figflow fixpdfmag font-change fontch hyplain jsmisc mkpattern newsletr placeins-plain \
	plgraph plnfss resumemac timetable treetex typespec varisize vertex graphics-pln js-misc pitex \
	getoptk hanoi ifetex plipsum plstmary present ; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-plain $j
		done
	done

	## cyrillic language support
	for i in cmcyr cmcyralt cyrillic cyrillic-bin cyrplain disser eskd eskdx gost lcyw lh lhcyr t2 timescyr \
	russ ; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-lang-cyrillic $j
		done
	done

	## extra languages packages
	for i in arabi arabtex armenian bangtex bengali burmese cjhebrew croatian ctib devnag ethiop ethiop-t1 \
	fc hrlatex itrans malayalam mongolian-babel montex sanskrit soyombo velthuis vntex wnri otibet turkmen \
	persian-bib xepersian ocherokee oinuit spanglish wnri-latex persian-modern aramaic-serto amiri basque-book \
	basque-date frenchle germkorr itnumpar lithuanian schule tracklang translations dad; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-lang-extra $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-lang-extra $k
			fi
		fi
		done
	done

	## greek language support
	for i in betababel bgreek cbfonts gfsbaskerville gfsporson greek-inputenc greekdates greektex grverb \
	ibycus-babel ibygrk kdgreek kerkis levy lgreek mkgrkindex teubner xgreek yannisgr pxgreeks textgreek \
	lgrx greek-fontenc begingreek cbfonts-fd; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			if Fuse $USE_GREEK; then
				Fsplit $pkgname-lang-greek $j
			else
				Frm $j
			fi
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				if Fuse $USE_GREEK; then
					Fsplit $pkgname-lang-greek $k
				else
					Frm $k
				fi
			fi
		fi
		done
	done

	## chineese, corean, japaneese language packages
	for i in arphic c90 cjk cjkpunct cjkutils cns ctex dnp garuda-c90 norasi-c90 thailatex uhc \
	wadalab zhmetrics zhspacing adobemapping japanese-otf japanese-otf-uptex jfontmaps kanji-config-updmap \
	kanji-config-updmap-sys kanji-fontmap-creator ptex2pdf nanumtype1 pxchfon bxbase bxjscls cjk-ko pxcjkcat \
	xpinyin zxjafbfont bxcjkjatype kotex-oblivoir kotex-utf xcjk2uni zhnumber zxjafont zxjatype fandol \
	kotex-utils cjk-gs-integrate; do
		listdir=`find usr/share/texmf-dist/ -maxdepth 4 -name $i -type d`
		for j in  $listdir ; do
			if Fuse $USE_CJK; then
				Fsplit $pkgname-lang-cjk $j
			else
				Frm $j
			fi
		done
		listfile=`find usr/bin/ -name $i -type f `
		for p in  $listfile ; do
			if Fuse $USE_CJK; then
				Fsplit $pkgname-lang-cjk $p
			else
				Frm $p
			fi
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				if Fuse $USE_CJK; then
					Fsplit $pkgname-lang-cjk $k
				else
					Frm $k
				fi
			fi
		fi
		done
	done

	## some latex3 packages
	for i in expl3 keys3 mh xpackages l3experimental l3kernel l3packages lt3graph ; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-latex3 $j
		done
	done

	## extra latex packages
	for i in AkkTeX ESIEEcv HA-prosper Tabbing a0poster abstract achemso acronym addlines adrconv \
	adrlist akletter alterqcm altfont amsaddr animate anonchap answers anyfontsize appendix arcs \
	arrayjob assignment attachfile authoraftertitle authorindex autotab beamer-contrib beamerposter \
	begriff beton bez123 bezos bigfoot binomexp bizcard blindtext blowup boites bookest booklet boolexpr \
	bophook boxhandler bracketkey breakurl bullcntr bussproofs calctab calrsfs calxxxx captcont casyl \
	catechis cbcoptic ccaption cclicenses cd cd-cover cdpbundl cellspace changebar changelayout \
	changepage changes chappg chapterfolder chletter chngcntr circ cjw clefval cleveref clock cmdstring \
	cmdtrack cmsd codedoc codepage colorinfo colorwav combine comment concprog constants contour cooking \
	cool coollist coolstr cooltooltips coordsys courseoutline coursepaper coverpage crossreference \
	csquotes csvtools cuisine currvita cursor cv cweb-latex cwpuzzle dashbox dashrule datatool \
	dateiliste datenumber datetime decimal delimtxt diagnose dialogl dichokey dinbrief directory dlfltxb \
	dnaseq docmfp doi dotarrow dotseqn dox dpfloat dprogress drac draftcopy draftwatermark dtk dtxgallery \
	dvdcoll eCards eanisbn easy easylist ebezier ecclesiastic ecv ed edmargin eemeir egplot ellipsis \
	elmath elpres elsarticle em emptypage emulateapj endfloat endheads engpron engrec enumitem envbig \
	environ envlab epigraph epiolmec eqexam eqlist eqname eqparbox errata esdiff esint esint-type1 etaremune \
	etextools etoolbox eukdate europecv everypage exam examdesign examplep exceltex exercise exp-testopt \
	expdlist export extract facsimile fancynum fancytooltips figsize filecontents fink fixfoot fixme flabels \
	flacards flagderiv flashcards flippdf floatrow flowfram fltpage fmp fmtcount fn2end fnbreak fncychap \
	foilhtml fonttable footmisc footnpag forarray forloop formlett formular fragments frankenstein fribrief \
	fullblck fullpict fundus g-brief gauss gcard gcite genmpage getfiledate ginpenc gloss glossaries gmdoc \
	gmdoc-enhance gmeometric gmiflink gmutils gmverb graphicx-psmin grfpaste grid gridset guitlogo hanging \
	harpoon hc hhtensor histogr hitec hpsdiss hvfloat hypdvips hyper hyperref-docsrc hyperxmp hyphenat ifmslide \
	ifmtarg ifplatform image-gallery import inlinedef interactiveworkbook inversepath iso10303 iso isodate isodoc \
	isonums isorot isotope kastrup kerntest keycommand keystroke labbook labelcas labels lastpage latex-tds \
	layouts lazylist lcd lcg leading leaflet leftidx lettre lewis lhelp limap lipsum listliketab \
	listofsymbols lkproof localloc logical-markup-utils logpap lsc ltablex ltabptch ltxdockit ltxindex ltxnew \
	mailing mailmerge makebarcode makebox makecell makecirc makecmds makedtx makeglos manfnt manuscript \
	mapcodes maple marginnote mathexam maybemath mcaption mceinleger mcite mciteplus memexsupp menu method \
	metre mff mftinc midpage minibox minipage-marginpar minutes misc209 mla-paper mlist mmap moderncv \
	modref modroman morefloats moresize moreverb movie15 mparhack msc msg mslapa mtgreek multenum multibbl \
	multicap multirow nag namespc ncclatex ncctools needspace newfile newlfm newspaper newvbtm nextpage \
	nfssext-cfr niceframe nicetext noitcrul nomencl nomentbl nonfloat notes ntabbing ntheorem numname \
	numprint ocr-latex octavo oldstyle onlyamsmath opcit outline outliner pagecont pagenote paper \
	papercdcase papertex paralist paresse patch patchcmd pauldoc pawpict pax pbox pbsheet pdfcomment \
	pdfcprot pdfmarginpar pdfscreen pdfslide pdfsync pdfwin pdfx pecha perltex permute petiteannonce \
	philex photo pittetd placeins plates plweb polyglot polynom polynomial polytable postcards ppower4 \
	ppr-prv preprint prettyref preview printlen probsoln program progress properties prosper protex protocol \
	psfragx pst-pdf pstool qcm qstest qsymbols quotchap quotmark randtext rangen rccol rcs-multi rcsinfo recipe \
	recipecard rectopma refcheck refman refstyle regcount register relenc repeatindex rjlparshap rlepsf rmpage \
	robustcommand robustindex romannum rotfloat rotpages rtkinenc sagetex sauerj savefnmark savesym savetrees \
	scale scalebar sciwordconv script sdrt sectionbox sectsty selectp semantic semioneside seqsplit sf298 sffms \
	sfheaders sfmath shadbox shadethm shapepar shipunov shorttoc show2e showdim showexpl showlabels sidecap silence \
	simplecv simplewick slantsc slashbox smalltableof smartref snapshot soul sparklines splitindex spotcolor \
	sprite spverbatim srcltx sseq ssqquote stack statistik stdclsdv stdpage stringstrings sttools subdepth \
	substr svgcolor svn svn-multi svn-prov svninfo syntax syntrace synttree tableaux tablenotes tablists \
	tabls tabto-ltx tabularcalc tabularew tabulary talk taupin tcldoc tdclock technics ted termcal \
	termlist texilikecover texlogos texmate texments texpower texshade textcase textfit textmerg \
	textpos theoremref thinsp thmtools threeparttablex thumb ticket timesht timing titlefoot \
	titlepic titlesec titling tocvsec2 todo todonotes tokenizer toolbox topfloat totcount totpages \
	tracking translator trfsigns trimspaces trivfloat trsym twoup typecm typedref typogrid ucs uebungsblatt ulsy \
	umoline underlin undertilde unroman upmethodology upquote ushort varindex varsfromjobname varwidth vector \
	verbatimbox verbatimcopy version versions vertbars vhistory vita vmargin volumes vpe vrsion vwcol wallpaper \
	warning warpcol was widetable williams wordlike wrapfig xargs xbmc xdoc xfor xifthen xmpincl xnewcommand \
	xoptarg xstring xtab xtcapts yafoot yagusylo yplan zed-csp ziffer zwgetfdate zwpagelayout a4wide a5comb \
	acromake advdate background baskervald bidi bigints blkarray block bold-extra boxedminipage braket breakcites \
	bundledoc cancel captdef capt-of cases ccicons censor cfr-lm chbibref chronology circle colordoc combelow \
	comma cookybooky currfile dashundergaps dblfloatfix endnotes eqell excludeonly filehook fix2col flashmovie \
	fncylab fnpara framed ftcap ftnxtra fwlw hvindex hypernat idxlayout imakeidx kix linegoal listing locality \
	magaz mdframed minted multibox mylatexformat newverbs nlctdoc nolbreaks nopageno notoccite ocgtools \
	optional ordinalpt oubraces pagerange pageslts papermas pdf14 plantslabels prerex relsize simplecd \
	skeycommand skeyval spreadtab standalone tabularborder texilikechaps tex-label threeparttable thumby \
	titleref truncate twoinone undolabl verbdef vruler xwatermark ydoc minitoc spanish-mx \
	units yfonts tocloft tocbibind supertabular subfloat subfigure subeqnarray subeqn lettrine caption \
	overpic xytree xyling acroterm adjmulticol bashful beamer2thesis beamerthemejltree beamerthemenirma \
	canoniclayout carlisle catchfilebetweentags catoption chet chextras collcell colortbl colourchange \
	cprotect csvsimple cutwin dirtytalk docmute ean13isbn easy-todo enumitem-zref eso-pic finstrut \
	fjodor hardwrap he-she ifnextok iwhdp koma-moderncvclassic marginfix mbenotes morehype newunicodechar \
	nonumonpart pagesLTS parselines piff progressbar regstats rvwrite serbian-lig sitem skb spot thumbs \
	tucv turnthepage sphack subfigmat tabu shadow secdot romanneg fancytabs fileinfo filemod cals \
	calxxxx-yyyy catoble-build-in-source-treeptions hrefhide footnoterange geschichtsfrkl gitinfo ghab harnon-cv hletter hobete \
	ifoddpage ifthenx invoice impnattypo issuulinks jlabels jvlisting kantlipsum kdgdocs keyreader keyval2e \
	koma-script-sfs lmake logbox longnamefilelist lstaddons ltxkeys ltxtools media9 meetingmins menukeys \
	moderntimeline monofill moreenum multienv musuos mversion mwe mycv nameauth nicefilelist outlines pagecolor \
	paracol parnotes quoting realboxes regexpatch reotex romanbar romansh rviewport sepfootnotes \
	serbian-apostrophe serbian-date-lat serbian-def-cyr shadowtext sidenotes srbook-mem storebox storecmd \
	subfiles substitutefont tabfigures tablefootnote tagging tcolorbox tram tsemlines tui verbments vocaltract \
	xcite xpatch xpunctuate friulan decorule bhcexam beameraudience collectbox cookingsymbols copyrightbox \
	coseoul crbox delim dhua diagbox documentation droit-fr easyfig emarks floatflt fnpct fontaxes fullwidth \
	fundus-calligra fundus-cyr fundus-sueterlin abraces acro actuarialangle apptools autopdf bxdpx-beamer \
	calcage calculator chkfloat classics clipboard concepts GS1 contracard counttexruns download dynblocks \
	embrac enotez esami etoc exsheets exsol factura filedate fixmetodonotes fnumprint footnotebackref \
	foreign frege iitem incgraph ktv-texdata lisp-on-tex mandi memory mnotes multiexpand nestquot newenviron \
	noconflict numberedblock ocg-p ocgx poetrytex python ran_toks readarray scalerel showcharinbox skdoc \
	skrapport snotez tableof tamefloats threadcol titlecaps typeface typehtml underoverlap uwmslide vdmlisting \
	xpeek akktex alnumsec any足size appendixnumberbeamer arraysort articleingud arydshln assoccnt avremu \
	bankstatement basicarith bchart beamerdarkthemes beamersubframe beamerthemephnompenh beamertheme-upenn-bc \
	bnumexpr bookcover booktabs boxedminipage2e calculation cfr-initials cite classpack cnltx cntformats \
	cntperchap codesection colorspace colorweb cv4tw cyber cybercic dataref datetime2 datetime2-bahasai \
	datetime2-basque datetime2-breton datetime2-bulgarian datetime2-catalan datetime2-croatian datetime2-czech \
	datetime2-danish datetime2-dutch datetime2-en-fulltext datetime2-english datetime2-esperanto datetime2-estonian \
	datetime2-finnish datetime2-french datetime2-galician datetime2-german datetime2-greek datetime2-hebrew \
	datetime2-icelandic datetime2-irish datetime2-italian datetime2-it-fulltext datetime2-latin datetime2-lsorbian \
	datetime2-magyar datetime2-norsk datetime2-polish datetime2-portuges datetime2-romanian datetime2-russian \
	datetime2-samin datetime2-scottish datetime2-serbian datetime2-slovak datetime2-slovene datetime2-spanish \
	datetime2-swedish datetime2-turkish datetime2-ukrainian datetime2-usorbian datetime2-welsh denisbdoc detlev-cm \
	diadia doclicense doctools efbox embedall epyt europasscv exam-n fcolumn fixocgx frontespizio gender getmap \
	gitinfo2 glossaries-danish glossaries-dutch glossaries-english glossaries-french glossaries-german \
	glossaries-irish glossaries-italian glossaries-magyar glossaries-polish glossaries-portuges glossaries-serbian \
	glossaries-spanish grid-system handout hang idxcmds inputtrc interfaces jslectureplanner jumplines l3build \
	lastpackage lengthconvert listlbls longfigure macroswap minorrevision morewrites mweights noindentafter nox \
	pas-cours pas-crosswords pas-cv pas-tableur pgf-umlcd pkgloader refenums repltext romanbarpagenumber \
	scanpages seealso sslides stackengine statex sympytexpackage tablestyles tabstackengine tagpair tasks \
	templatetools testhyphens textpath unravel uri verbasef versonotes vgrid withargs xcolor-solarized xhfill \
	xprintlen fancyslides fancylabel polyglossia simurgh; do
		listdir=`find usr/share/texmf-dist/ -maxdepth 2 -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-latex-extra $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-latex-extra $k
			fi
		fi
		done
	done
	## always be carefull with the above lists, this one can broke context =)

	## graphics related packages
	for i in asyfig autoarea bardiag cachepic circuitikz curve curve2e curves dcpic diagmac2 doc-pictex \
	dot2texi dottex dratex eepic epspdf epspdfconversion fig4latex gnuplottex miniplot pb-diagram \
	petri-nets pgf-soroban pgfopts pgfplots picinpar pict2e pictex pictex2 pinlabel pmgraph randbild \
	schemabloc swimgraf texdraw tikz-inet tikz-timing tkz-doc tkz-linknodes tkz-tab tufte-latex xypic \
	combinedgraphics duotenzor drs esk here knitting knittingpattern mathspic tikz-3dplot tikz-qtree \
	tkz-orm xypdf chemfig bloques bodegraph bondgraphs gincltex gmp gradientframe graphcet lpic \
	numericplots pgf pgfgantt pgf-umlsd productbox randomwalk tkz-base tkz-berge tkz-euclide \
	tkz-fct tkz-graph tkz-kiviat graphcet lapdf pgf-blur pgfkeyx tikz-cd tikz-dependency \
	tikzpagenodes tikzpfeile tqft bxeepic flowchart forest hf-tikz hobby makeshape pxpgfmark \
	sa-tikz setdeck smartdiagram spath3 svg tikzinclude tikzmark tikzorbital tikzposter \
	tikzscale tikzsymbols xpicture aobs-tikz asypictureb blox celtic genealogytree grafcet \
	graphbox graphicxbox graphviz harveyballs havannah labyrinth qrcode reflectgraphics \
	rulercompass ticollege tikz-dimline tikz-opm tikz-palattice timing-diagrams; do
		listdir=`find usr/share/texmf-dist/ -maxdepth 4 -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-graphics $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-graphics $k
			fi
		fi
		done
	done

	## pstricks related packages
	for i in auto-pst-pdf bclogo makeplot pdftricks psbao pst-2dplot pst-3d pst-3dplot pst-abspos pst-asr \
	pst-bar pst-barcode pst-bezier pst-blur pst-bspline pst-calendar pst-circ pst-coil pst-cox pst-dbicons \
	pst-diffraction pst-eps pst-eucl pst-fill pst-fr3d pst-fractal pst-fun pst-func pst-gantt pst-geo \
	pst-ghsb pst-gr3d pst-grad pst-infixplot pst-jtree pst-labo pst-lens pst-light3d pst-math pst-ob3d \
	pst-optexp pst-optic pst-osci pst-pad pst-pdgr pst-poly pst-qtree pst-sigsys pst-slpe pst-solides3d \
	pst-soroban pst-spectra pst-stru pst-support pst-text pst-tree pst-uml pst-vowel pst-vue3d pst2pdf \
	pstricks pstricks-add uml vaucanson-g pst-knot pst-am pst-electricfield pst-exa pst-magneticfield \
	pst-mirror pst-node pst-platon pst-plot pst-thick pst-tvz pst-layout pst-pulley pst-rubans \
	pst-solarsystem pst-tools pst-ode pst-vectorian pst-fit pst-graphicx pdftricks2 pst-intersect \
	pst-ovl pst-perspective pst-spirograph; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-pstricks $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-pstricks $k
			fi
		fi
		done
	done

	## science related packages
	for i in SIstyle SIunits alg algorithm2e algorithmicx algorithms biocon bpchem bytefield chemarrow \
	chemcompounds chemcono chemstyle clrscode complexity computational-complexity digiconfigs dyntree \
	eltex formula fouridx functan galois gastex gene-logic gu hep hepnames hepparticles hepthesis \
	hepunits karnaugh mhchem mhs miller objectz pseudocode scientificpaper sciposter sfg siunitx \
	steinmetz struktex t-angles textopo ulqda unitsdef youngtab engtlc feynmf c-pascal fltpoint \
	r_und_s chemexec chemmacros drawstack mychemestry nuc ot-tableau physymb rec-thy modiagram \
	mychemistry sasnrdisplay bohr chemnum endiagram enigma substances askmaps autonum chemformula \
	chemgreek chemschemex clrscode3e cryptocode dsptricks esrelation feynmp-auto ghsystem karnaughmap \
	logicproof lplfitch matlab-prettifier neuralnetwork pygmentex qcircuit ribbonproofs rterface \
	sclang-prettifier shdoc xymtex ytableau; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-sciences $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-sciences $k
			fi
		fi
		done
	done

	## maths related packages
	for i in 12many amstex boldtensors bosisio ccfonts commath concmath concmath-fonts concrete extarrows extpfeil \
	faktor ionumbers isomath mathcomp mathdots mattens mhequ multiobjective nath proba shuffle statex2 \
	stmaryrd susy syllogism synproof tablor tensor tex-ewd thmbox turnstile venn yhmath fast-diagram \
	sansmath tdsfrmath eqnarray libgreek mathalfa mathastext coolthms minifp xint bropd conteq interval \
	physics skmath venndiagram braids breqn ebproof mafr mfpic4ode backnaur; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-sciences $j
		done
	done

	## some utilities binaries that we don't absolutly need in texlive base pkg
	for i in accfonts fontware lcdftypetools ps2pkm pstools dvipsconfig fontinst afm2pl fontools \
	mft ttfutils a2ping bibtex8 ctie cweb detex dtl dvi2tty dviasm dvicopy dviljk dvipos findhyph \
	getnonfreefonts hyphenex latex2man listings-ext mkind-english mkjobtexmf patgen pdfcrop pdftools \
	pkfix pkfix-helper seetexk synctex texcount texdiff texdirflatten texloganalyser texware tie \
	tpic2pdftex web pfarrei; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			Fsplit $pkgname-utils $j
		done
		listfile=`find usr/bin/ -name $i -type f `
		for j in  $listfile ; do
			Fsplit $pkgname-utils $j
		done
		for k in usr/bin/* ; do
		if [ -L $k ]; then
			target=`ls -l "$k" | sed 's/^.\+ -> //' | grep "\(^\|/\)$i\($\|/\)"`
			if [[ "$target" != "" ]]; then
				Fsplit $pkgname-utils $k
			fi
		fi
		done
	done

	## Split Omega Tex extension
	for i in omega aleph lambda antomega mxd mxedruli omegaware ; do
		listdir=`find usr/share/texmf-dist/ -name $i -type d `
		for j in  $listdir ; do
			# two omega in a path so the bad one is moved before the other
			if [ -d $j ]; then
				Fsplit $pkgname-omega $j
			fi
		done
	done


	## Split xindy
	Fmv usr/share/texmf-dist/xindy usr/share/
	Fsplit $pkgname-xindy usr/share/xindy
	Fsplit $pkgname-xindy usr/bin/*xindy*
	Fsplit $pkgname-xindy usr/share/texmf-dist/scripts/xindy

	## Add 09-texlive.conf font file (for XeteX)
	Fmkdir etc/fonts/conf.avail/
	Ffile 09-texlive.conf /etc/fonts/conf.avail/09-texlive.conf

	Fsplit texlive-kpathsea	/usr/lib/libkpathsea.so\*
	Fsplit texlive-ptexen	/usr/lib/libptexenc.so\*
	Fsplit texlive-synctex	/usr/lib/libsynctex.so\*
	Fsplit texlive-lua	/usr/lib/libtexlua\*

	Fsplit texlive-kpathsea	usr/lib/pkgconfig/kpathsea.pc
	Fsplit texlive-ptexen	usr/lib/pkgconfig/ptexenc.pc
	Fsplit texlive-synctex	usr/lib/pkgconfig/synctex.pc
	Fsplit texlive-lua	usr/lib/pkgconfig/texlua53.pc
	Fsplit texlive-lua	usr/lib/pkgconfig/texluajit.pc

}

# optimization OK
