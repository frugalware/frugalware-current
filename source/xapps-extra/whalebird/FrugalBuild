# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=whalebird
pkgver=5.0.7
pkgrel=2
pkgdesc="An Electron based Mastodon, Pleroma and Misskey client"
archs=('x86_64')
groups=('xapps-extra')
url="https://whalebird.social"
depends=(alsa-lib at-spi2-atk cairo dbus gdk-pixbuf2 glib2 \
	gtk+3 hicolor-icon-theme libcups libglvnd libx11 libxcb \
	libxcomposite libxcursor libxdamage libxext libxfixes \
	libxi libxrandr libxrender libxtst nspr nss pango)
makedepends=('yarn' 'nodejs' 'git')
_F_github_author=h3poteto
_F_github_name=whalebird-desktop
_F_github_tag_v=y
_F_github_grepv="alpha\|beta\|-rc.1"
Finclude github
source+=(whalebird.desktop \
	electron-builder.yml )
sha1sums=('2fd90fd4bd86e93f4d6d4331e1098c25f8d53657' \
          '5da78a89823b9ef232c921379205ab041a5747b3' \
          'd8ab5f44ae4a847a67ee03363c72e60e7d68f229')
_F_cd_path="${_F_github_name}-$pkgver"

build(){
        Fcd
        Fpatchall
	rm -f electron-builder.json

	Fexec make build || Fdie
	Fexec npx electron-builder --dir --config ../electron-builder.yml || Fdie

	Finstall 644 usr/share/applications/$pkgname.desktop
	Fmkdir usr/lib
	Fmkdir usr/bin

	Fcprel build/linux-unpacked usr/lib/$pkgname-desktop
	Fln /usr/lib/${pkgname}-desktop/whalebird /usr/bin/whalebird

	for i in 16 32 128 256 512; do
		Finstallrel 644 build/icons/icon.iconset/icon_${i}x${i}.png /usr/share/icons/hicolor/${i}x${i}/apps/whalebird.png
	done
}

# optimization OK
