# Compiling Time: 64.56 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=qt6-base
pkgver=6.4.1
pkgrel=1
pkgdesc="The Qt6 GUI toolkit."
archs=('x86_64')
depends=("libjpeg-turbo" "xcb-util-keysyms" "xcb-util-cursor" "libglvnd" \
	"fontconfig" "xdg-utils" "shared-mime-info" "xcb-util-wm" \
	"libxrender" "libxi" "sqlite3" "vulkan-headers"  \
	"libinput" "libxkbcommon" "libproxy" "libcups" \
	"double-conversion" "brotli" "md4c" "at-spi2-core")
_F_cmake_confopts="	-DINSTALL_BINDIR=lib/qt6/bin \
			-DINSTALL_PUBLICBINDIR=usr/bin \
			-DINSTALL_LIBEXECDIR=lib/qt6 \
			-DINSTALL_DOCDIR=share/doc/qt6 \
			-DINSTALL_ARCHDATADIR=lib/qt6 \
			-DINSTALL_DATADIR=share/qt6 \
			-DINSTALL_INCLUDEDIR=include/qt6 \
			-DINSTALL_MKSPECSDIR=lib/qt6/mkspecs \
			-DINSTALL_EXAMPLESDIR=share/doc/qt6/examples \
			-DQT_FEATURE_journald=ON \
			-DQT_FEATURE_openssl_linked=ON \
			-DQT_FEATURE_system_sqlite=ON \
			-DQT_FEATURE_system_xcb_xinput=ON \
			-DQT_FEATURE_accessibility=ON \
			-DQT_FEATURE_fontconfig=ON \
			-DQT_FEATURE_glib=ON \
			-DQT_FEATURE_icu=ON \
			-DQT_FEATURE_enable_new_dtags=ON \	
			-DQT_FEATURE_reduce_relocations=OFF \
			-DQT_FEATURE_relocatable=OFF \
			-DQT_FEATURE_system_jpeg=ON \
			-DQT_FEATURE_system_png=ON \
			-DQT_FEATURE_system_zlib=ON \
			-DQT_FEATURE_sql_odbc=ON \
			-DQT_FEATURE_sql_mysql=ON \
			-DQT_FEATURE_sql_psql=ON \
			-DQT_FEATURE_sql_sqlite=ON \
			-DQT_FEATURE_rpath=OFF \	
			-DBUILD_SHARED_LIBS=ON \
			-DCMAKE_INTERPROCEDURAL_OPTIMIZATION=ON"
_F_cmake_build_dir="build"
Finclude qt6
makedepends+=('systemd-devel' 'libfbclient' 'mariadb-libs' 'unixodbc' 'postgresql' \
	'alsa-lib' 'gst1-plugins-base' 'gtk+3' 'pulseaudio' 'cups' 'freetds' 'xmlstarlet')
source+=(qt6-base-cflags.patch)

sha1sums=('46ca15cdce94e4dc87fbeeadb959fc8f0238a012' \
          '9d9b059b3aeb1797c46ac69a3555a0321da6c7db')

build() {
	Fcd
	Fexec rm -rf src/3rdparty/{harfbuzz-ng,freetype,libjpeg,libpng,sqlite,zlib} || Fdie

	# Hack
	export LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:$Fsrcdir/$_F_cd_path/${_F_cmake_build_dir}/lib"
	CMake_build
}

# optimization OK
