# Compiling Time: 0.01 SBU
# Maintainer: DeX77 <dex77@frugalware.org>

pkgname=tg_owt
pkgver=20221129.g621f3da
pkgrel=1
pkgdesc='WebRTC build for Telegram'
archs=('x86_64')
groups=('xlib-extra')
depends=('libdrm')
makedepends=('protobuf>=21.5' 'pipewire' 'libxrandr' 'libxcomposite' \
	'libxdamage' 'abseil-cpp' 'libgbm' 'libjpeg-turbo' \
	'ffmpeg4.4' 'openssl1.1' 'opus' 'yasm' 'x11-protos')
_F_github_author="desktop-app"
_F_github_devel=y
_F_scm_want_up2date=yes
_F_cmake_use_ninja=true
_F_scm_git_cloneopts="--recurse-submodules"
_F_cmake_confopts="	 -DBUILD_SHARED_LIBS=OFF"
Finclude github cmake
options=('static' 'force')
source=(0001-fix-h265_pps_parser-fix-missing-cstdint-include.patch)

build() {
	Funpack_scm
	Fcd
	Fexec git checkout 442d5bb593c0ae314960308d78f2016ad1f80c3e || Fdie
	Fexec git submodule update --recursive || Fdie
	export PKG_CONFIG_PATH='/usr/lib/ffmpeg4.4/pkgconfig:/usr/lib/openssl-1.1/pkgconfig'
	CMake_build
}

# optimization OK
