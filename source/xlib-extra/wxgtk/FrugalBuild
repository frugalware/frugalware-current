# Compiling Time: 15.12 SBU
# Maintainer: crazy <crazy@frugalware.org>
# Contributor: Miklos Nemeth <desco@frugalware.org>

pkgname=wxgtk
pkgver=2.8.10.1
pkgrel=2
pkgdesc="GTK+ implementation of wxWidgets API for GUI'"
_F_sourceforge_dirname="wxwindows"
# this is the wxGTK tarball, but it's released more frequently
_F_sourceforge_dirname="wxpython"
_F_sourceforge_name="wxPython-src"
_F_sourceforge_ext=".tar.bz2"
Finclude sourceforge
url="http://www.wxwidgets.org/"
# TODO: gst*
depends=('libdrm' 'sdl' 'gtk+2>=2.20.0-2' 'libgl' 'freetype2' 'libxcb' 'glib2')
groups=('xlib-extra')
archs=('i686' 'x86_64' 'ppc')
options=('scriptlet')
replaces=('wxgtk-devel')
conflicts=('wxgtk-devel')
VER="2.8"
source=($source wxGTK-2.8.10-CVE-2009-2369.patch wxGTK-2.8.10-gsocket.patch)
sha1sums=('6598fbafd979a91f20100171fa23a91779f6dc62' \
          '36e74d5384e912f6bf1890c582d872b805e5bbfb' \
          '885442567f2f80f78f9ed4f0ac2483c6fc932efe')

subpkgs=("$pkgname-locale" "$pkgname-u8")
subdescs=('Locale files for wxWidgets' "GTK+ implementation of wxWidgets API for GUI (unicode).")
subgroups=('locale-extra' 'xlib-extra')
subdepends=("$pkgname=$pkgver" "$pkgname=$pkgver")
subarchs=('i686 x86_64 ppc' 'i686 x86_64 ppc')

[ "$CARCH" == "x86_64" ] && export CFLAGS="$CFLAGS -fPIC"
[ "$CARCH" == "x86_64" ] && export CXXFLAGS="$CXXFLAGS -fPIC"

wx_compile()
{
	make || Fdie
	Fmakeinstall
	cd contrib/src || Fdie
	Fconf
        make || Fdie
	Fmakeinstall
	cd ../.. || Fdie
}


build()
{
	cd $Fsrcdir || Fdie
	cp -r $_F_sourceforge_name-$pkgver $_F_sourceforge_name-$pkgver-u8 || Fdie
	## TODO: figure|enable more things
	wxconfig="--with-opengl \
		--enable-geometry \
		--enable-timer \
		--enable-sound \
		--with-sdl \
		--enable-graphics_ctx \
		--enable-mediactrl \
		--enable-display \
		--enable-plugins \
		--enable-compat24"
	## Unicode one
	cd $_F_sourceforge_name-$pkgver-u8 || Fdie
	Fpatchall
	autoconf || Fdie
	Fconf \
		${wxconfig} \
		--enable-unicode
	wx_compile
	Frm usr/lib/wx/${VER}
	## This is still not a solution ...
	Frm usr/include usr/share/aclocal usr/share/bakefile usr/share/locale usr/bin/wx-config usr/bin/wxrc
	Fln /usr/lib/wx/config/gtk2-unicode-release-${VER} /usr/bin/wx-config-u8
	Fmv /usr/bin/wxrc-${VER} /usr/bin/wxrc-${VER}-u8
	Fln /usr/bin/wxrc-${VER}-u8 /usr/bin/wxrc-u8
	Fsplit $pkgname-u8 /usr
	## Normal build
	cd ../$_F_sourceforge_name-$pkgver
	Fpatchall
	autoconf || Fdie
	Fconf \
                ${wxconfig} \
                --disable-unicode
        wx_compile
	Frm usr/bin/wx-config
	Fln /usr/lib/wx/config/gtk2-ansi-release-${VER} /usr/bin/wx-config
	## lang stuff ( why is this split anyway ? )
	Fsplit $pkgname-locale usr/share/locale
}

# optimization OK
