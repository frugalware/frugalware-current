# Compiling Time: 64.56 SBU
# Maintainer: crazy <crazy@frugalware.org>

pkgname=qt5-webengine
pkgver=5.15.8
pkgrel=1
depends=("qt5-declarative>=5.15" "qt5-webchannel>=5.15" "qt5-location>=5.15" 'libxcomposite>=0.4.4-3' \
	'libxrandr>=1.5.0-5' 'nss>=3.26' 'libxtst>=1.2.2-3' 'libxscrnsaver>=1.2.2-3' 'zlib>=1.2.8-8' 'libwebp>=0.5.1-2' \
	'libxml2>=2.9.4-3' 'libevent>=2.1.11' 'jsoncpp>=1.7.5' 'opus>=1.1.3-2' 'libvpx>=1.6.0-2' 'snappy>=1.1.6' \
	'icu4c>=68.1' 'libxml2' 'lcms2' 're2>=2020.11.01' 'ffmpeg>=4.1' 'libsrtp>=1.5.4-4' 'libjpeg-turbo' 'opus' 'alsa-lib' 'libxslt' 'protobuf')
makedepends=('git' 'ninja' 'x11-protos' 'poppler' 'poppler-qt5' 'poppler-glib' "qt5-tools>=5.15" 'bison' 'nodejs')
_F_github_grep=5.15
_F_github_author=qt
_F_github_name=qtwebengine
_F_github_tag_v=y
_F_scm_tag="v${pkgver}-lts"
_F_scm_type=git
_F_scm_url=https://github.com/$_F_github_author/${_F_github_name}.git
_F_scm_git_cloneopts="--recurse-submodules"
Finclude scm qt5 github
unset source
up2date="$up2date | sed 's/-lts//g'"

build()
{
	Funpack_scm
	Fexec git submodule set-branch --branch 87-based src/3rdparty || Fdie
	Fexec git submodule update || Fdie

	Fcd
	Fpatchall

	Fexec qmake-qt5 \
			QMAKE_EXTRA_ARGS+=" -system-ffmpeg -system-webengine-icu -webengine-proprietary-codecs" \
			QMAKE_EXTRA_ARGS+=" -webengine-alsa -webengine-pulseaudio -webengine-printing-and-pdf -verbose" || Fdie
	Fexec make -j $(getconf _NPROCESSORS_ONLN) || Fdie
	Fexec make INSTALL_ROOT=$Fdestdir install || Fdie

	Ffix_la_files
	Frm usr/share/qt5/resources/icudtl.dat

}

# optimization OK
