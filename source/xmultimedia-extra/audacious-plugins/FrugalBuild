# Compiling Time: 0.37 SBU
# Maintainer: James Buren <ryuo@frugalware.org>

pkgname=audacious-plugins
pkgver=2.4.3
pkgrel=2
pkgdesc="Plugins for audacious."
url="http://audacious-media-player.org"
depends=('audacious>=2.4.3' 'flac>=1.1.4' 'libvorbis' 'unzip' 'lame' 'libmad' \
         'libxcomposite' 'alsa-lib' 'faad2' 'libsamplerate')
makedepends=('krb5')
# Blue tooth disabled because of compile errors.
conflicts=('audacious-plugin-arts' 'audacious-plugin-musepack' \
           'audacious-plugin-bluetooth' 'audacious-plugin-lastfm' \
           'audacious-plugin-scrobbler' 'audacious-plugin-esd' \
           'audacious-plugin-icecast')
replaces=(${conflicts[@]})
groups=('xmultimedia-extra')
archs=('i686' 'x86_64')
options=('scriptlet')
up2date="lynx -dump '$url/downloads' | grep -o '$pkgname-\(.*\).tgz' | tail -n1 | sed 's|$pkgname-\(.*\).tgz|\1|'"
source=(http://distfiles.atheme.org/$pkgname-$pkgver.tgz libnotify07.diff)
sha1sums=('b89f87e9abb0249cb6b8318ed8fa58bb7bb27c67' \
          '2ebeb4373b9ef48620799e86aafb5a904b8869a3')

subpkgs=( "audacious-plugin-jack" "audacious-plugin-neon"             \
          "audacious-plugin-wavpack" "audacious-plugin-sidplay"       \
          "audacious-plugin-mtp" "audacious-plugin-mms"               \
          "audacious-plugin-pulseaudio" "audacious-plugin-paranormal" \
          "audacious-plugin-adplug" "audacious-plugin-cd"             \
          "audacious-plugin-sndfile" "audacious-plugin-cue"           \
          "audacious-plugin-bs2b" "audacious-plugin-projectm"         \
          "audacious-plugin-ffaudio" "audacious-plugin-fluidsynth"    \
          "audacious-plugin-notify" )
subdescs=( 'Audacious jack output plugin' 'Audacious neon transport plugin'  \
           'Audacious wavpack input plugin' 'Audacious sidplay input plugin' \
           'Audacious mtp general plugin' 'Audacious mms transport plugin'   \
           'Audacious pulseaudio output plugin'                              \
           'Audacious paranormal visualization plugin'                       \
           'Audacious adplug input plugin' 'Audacious cd input plugin'       \
           'Audacious sndfile input plugin' 'Audacious cue container plugin' \
           'Audacious bs2b effect plugin'                                    \
           'Audacious projectm visualization plugin'                         \
           'Audacious ffaudio input plugin'                                  \
           'Audacious fluidsynth input plugin'                               \
           'Audacious notify general plugin' )
subdepends=( "jack" "neon>=0.28.3" "wavpack>=4.40.0" "libsidplay libsidplay2" \
             "libmtp" "libmms" "pulseaudio libcap>=2.19" "sdl" "adplug>=2.1"  \
             "libcdio>=0.80-2" "libsndfile" "libcue>=1.4.0" "libbs2b"         \
             "libprojectm gtkglext" "ffmpeg libraw1394" "fluidsynth"
             "libnotify>=0.7" )

for i in $(seq 0 $(echo ${#subpkgs[@]} - 1 | bc)); do
  subrodepends[$i]="$pkgname=$pkgver"
  subarchs[$i]=${archs[@]}
  subgroups[$i]=${groups[@]}
done

if [ "$CARCH" != "ppc" ]; then
subpkgs=("${subpkgs[@]}" 'audacious-plugin-lirc')
subdescs=("${subdescs[@]}" 'Audacious lirc plugin')
subdepends=("${subdepends[@]}" "lirc")
subrodepends=("${subrodepends[@]}" "$pkgname=$pkgver")
subgroups=("${subgroups[@]}" 'xmultimedia-extra')
subarchs=("${subarchs[@]}" 'i686 x86_64')
fi

build()
{
	Fcd
	Fpatchall
	if [ "$CARCH" == "i686" ]; then
		opts="--disable-sse2"
	fi
	Fmake \
		--prefix=/usr \
		--enable-chardet \
		--enable-ipv6 \
		--enable-amidiplug \
		--disable-dependency-tracking \
    --enable-scrobbler \
		$opts
	## Fbuild/Fmakeinstall does not work
	make DESTDIR=$Fdestdir install || Fdie
	Fsplit audacious-plugin-jack usr/lib/audacious/Output/jackout.so
	if [ "$CARCH" != "ppc" ]; then
		Fsplit audacious-plugin-lirc usr/lib/audacious/General/lirc.so
	fi
	Fsplit audacious-plugin-neon usr/lib/audacious/Transport/neon.so
	Fsplit audacious-plugin-wavpack usr/lib/audacious/Input/wavpack.so
	Fsplit audacious-plugin-sidplay usr/lib/audacious/Input/sid.so
	Fsplit audacious-plugin-mtp usr/lib/audacious/General/mtp_up.so
	Fsplit audacious-plugin-mms usr/lib/audacious/Transport/mms.so
	Fsplit audacious-plugin-pulseaudio usr/lib/audacious/Output/pulse_audio.so
	Fsplit audacious-plugin-paranormal usr/lib/audacious/Visualization/paranormal.so
	Fsplit audacious-plugin-adplug usr/lib/audacious/Input/adplug.so
	Fsplit audacious-plugin-cd usr/lib/audacious/Input/cdaudio-ng.so
	Fsplit audacious-plugin-sndfile usr/lib/audacious/Input/sndfile.so
	Fsplit audacious-plugin-cue usr/lib/audacious/Container/cue.so
	Fsplit audacious-plugin-bs2b usr/lib/audacious/Effect/bs2b.so
	Fsplit audacious-plugin-projectm usr/lib/audacious/Visualization/projectm-1.0.so
	Fsplit audacious-plugin-ffaudio usr/lib/audacious/Input/ffaudio.so
	Fsplit audacious-plugin-fluidsynth usr/lib/audacious/Input/amidi-plug/ap-fluidsynth.so
  Fsplit audacious-plugin-notify usr/lib/audacious/General/notify.so
}

# optimization OK
