# Compiling Time: 5.98 SBU
# Maintainer: Frugalware Dev Team

pkgname=opencv
pkgver=3.1.0
pkgrel=8
pkgdesc="Intel(R) Open Source Computer Vision Library"
url="http://opencv.org/"
depends=('jasper' 'gst1-plugins-base' 'openexr>=2.2.0' 'ffmpeg>=3.1.3' \
          'xine-lib>=1.2.2' 'libdc1394' 'v4l-utils' \
         'libunicap' 'libgl' 'zlib' 'libjpeg' 'libwebp' 'libpng'
         'libtiff' 'jasper' 'gdal' 'libdc1394' 'libgphoto2' 'eigen' 'libcl' \
         'libsm' 'libxt' 'qt5-base>=5.7.0-2' 'intel-tbb' 'protobuf')
makedepends+=('doxygen' 'numpy' 'numpy-python3' 'eigen' 'x11-protos' 'python3')
_F_github_author="Itseez"
_F_github_tag=y
_F_cmake_confopts+=" -DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_SKIP_RPATH=ON \
		-DWITH_XINE=ON \
		-DWITH_OPENMP=ON \
		-DWITH_OPENGL=ON \
		-DWITH_UNICAP=ON \
		-DBUILD_EXAMPLES=ON \
		-DBUILD_TESTS=OFF \
		-DINSTALL_C_EXAMPLES=ON \
 		-DINSTALL_PYTHON_EXAMPLES=ON \
		-DENABLE_SSE3=OFF \
		-DWITH_TBB=ON \
		-DWITH_GTK=OFF \
		-DWITH_GTK_2_X=OFF \
		-DWITH_VTK=OFF \
		-DWITH_QT=ON \
		-DOPENCV_EXTRA_MODULES_PATH=${Fsrcdir}/opencv_contrib-$pkgver/modules"

[[ "$CARCH" == "i686" ]] && _F_cmake_confopts+=" -DENABLE_SSE2=OFF"

Finclude github  cmake
options=('noccache' 'static')
groups=('xmultimedia-extra')
archs=('i686' 'x86_64')
#source=("${source[@]}" "${source[0]/opencv/opencv_contrib}")
#TODO: stupid same filename
source+=(https://github.com/opencv/opencv_contrib/archive/$pkgver.zip \
	5852.patch cmake-gcc6.patch)

sha1sums=('6bbe804d2b5de17cff73a5f56aa025e8b1e7f1fd' \
          '4c64e698fcf9c1a2e3720446bab4d7fc5f487064' \
          '430c776bbf66a69dbe590ceb58df22c0207e56a9' \
          '1589fd5cc1336e4d99c7d13f32392fe651e406da')

## TODO: some subpackages ?

subpkgs=("$pkgname-samples")
subdescs=("$pkgdesc Examples")
subdepends=('')
subrodepends=("$pkgname>=$pkgver")
subgroups=('xapps-extra') ## wrong but
subarchs=('x86_64 i686')

subpkgs+=("$pkgname-python3")
subdescs+=("Opencv python3 bindings")
subdepends+=('python3 numpy-python3')
subrodepends+=("$pkgname>=$pkgver")
subgroups+=('xapps-extra')
subarchs+=('x86_64 i686')

subpkgs+=("$pkgname-python2")
subdescs+=("Opencv python2 bindings")
subdepends+=('python numpy')
subrodepends+=("$pkgname>=$pkgver")
subgroups+=('xapps-extra')
subarchs+=('x86_64 i686')

build() {
	Fcd
	CMake_build

	## 32MB++
	Fsplit $pkgname-samples usr/share/OpenCV/samples

	Fsplit $pkgname-python2 usr/lib/python2.*/
	Fsplit $pkgname-python3 usr/lib/python3.*/

}
# optimization OK
