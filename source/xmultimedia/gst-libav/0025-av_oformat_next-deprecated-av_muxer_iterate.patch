From 2ec542f7c2a1e45ad8e22c4a77af2fd4d2cb5bdb Mon Sep 17 00:00:00 2001
From: Mathieu Duponchelle <mathieu@centricular.com>
Date: Fri, 29 Jun 2018 21:38:50 +0200
Subject: [PATCH 25/72] av_oformat_next (deprecated) -> av_muxer_iterate

https://bugzilla.gnome.org/show_bug.cgi?id=792900
---
 ext/libav/gstavmux.c | 14 +++++---------
 1 file changed, 5 insertions(+), 9 deletions(-)

diff --git a/ext/libav/gstavmux.c b/ext/libav/gstavmux.c
index c2ac7ec..32ebb4d 100644
--- a/ext/libav/gstavmux.c
+++ b/ext/libav/gstavmux.c
@@ -876,13 +876,12 @@ gst_ffmpegmux_register (GstPlugin * plugin)
     NULL, NULL, NULL
   };
   GType type;
-  AVOutputFormat *in_plugin;
-
-  in_plugin = av_oformat_next (NULL);
+  const AVOutputFormat *in_plugin;
+  void *i = 0;
 
   GST_LOG ("Registering muxers");
 
-  while (in_plugin) {
+  while ((in_plugin = av_muxer_iterate (&i))) {
     gchar *type_name;
     GstRank rank = GST_RANK_MARGINAL;
 
@@ -921,12 +920,12 @@ gst_ffmpegmux_register (GstPlugin * plugin)
         !strncmp (in_plugin->name, "webm", 4)
         ) {
       GST_LOG ("Ignoring muxer %s", in_plugin->name);
-      goto next;
+      continue;
     }
 
     if ((!strncmp (in_plugin->long_name, "raw ", 4))) {
       GST_LOG ("Ignoring raw muxer %s", in_plugin->name);
-      goto next;
+      continue;
     }
 
     if (gst_ffmpegmux_get_replacement (in_plugin->name))
@@ -954,9 +953,6 @@ gst_ffmpegmux_register (GstPlugin * plugin)
     }
 
     g_free (type_name);
-
-  next:
-    in_plugin = av_oformat_next (in_plugin);
   }
 
   GST_LOG ("Finished registering muxers");
-- 
2.17.0

