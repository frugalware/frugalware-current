#!/bin/bash

# (c) 2004 Vajna Miklos <mamajom@axelero.hu>
# genpkgdbs for FrugalWare
# distributed under GPL License

#if [ "$1" != "frugalware" -a "$1" != "extra" ]; then
#	echo "Hey, what repro? 'frugalware' or 'extra'?"
#	exit 1
#elif [ "$1" = "frugalware" ]; then
#	dir=..
#	name=current
#else # extra
#	dir=../extra
#	name=extra
#fi

# 1) Packages.lst
echo -n "Generating Packages.lst..."
( cd ..
  for i in `find source/* -name FrugalBuild|sed 's|.*/\(.*\)/\(.*\)/.*|\1/\2|'`
  do
  	echo -n $i|sed 's|\(.*\)/.*|\1/|'
  	( cd frugalware/;ls \
  	  |grep "^`echo $i|sed 's|.*/\(.*\)|\1|'`-[[:digit:]]"|grep fpm )
  done ) >../Packages.lst
echo " done"

# 2) Packages.lst for extra
echo -n "Generating Packages.lst for extra..."
( cd ../extra
  for i in `find source/* -name FrugalBuild|sed 's|.*/\(.*\)/\(.*\)/.*|\1/\2|'`
  do
  	echo -n $i|sed 's|\(.*\)/.*|\1/|'
  	( cd frugalware/;ls \
  	  |grep "^`echo $i|sed 's|.*/\(.*\)|\1|'`-[[:digit:]]"|grep fpm )
  done ) >../extra/Packages.lst
echo " done"

# 3) Filelist.txt
echo -n "Generating Filelist.txt..."
( cd ..
  echo -e "Last Modified: `LANG= LC_ALL= date`\n\nFrugalware Source Tree">Filelist.txt
  tree|grep -v ^\.$>>Filelist.txt )
echo " done"

# 3) frugalware/frugalware-current.fdb
( cd ../
  gensync source/ frugalware/frugalware-current.fdb )

# 4) extra/frugalware/extra-current.fdb
( cd ../extra
  gensync source/ frugalware/extra-current.fdb )

# 5) fixing permsissions
./fixperms
